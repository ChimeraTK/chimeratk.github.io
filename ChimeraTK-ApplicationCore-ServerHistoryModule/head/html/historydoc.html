<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ChimeraTK-ApplicationCore-ServerHistoryModule: Server based history module</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ChimeraTK_Logo_whitebg.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ChimeraTK-ApplicationCore-ServerHistoryModule
   &#160;<span id="projectnumber">01.01.02</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('historydoc.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Server based history module </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Klaus Zenker (HZDR) </dd></dl>
<dl class="section date"><dt>Date</dt><dd>10.08.2018</dd></dl>
<h1><a class="anchor" id="historyintro"></a>
Server based history</h1>
<p>Some control systems offer a variable history but some do not. In this case the <code>ServerHistory</code> can be used to create a history ring buffer managed by the server. If only a local history is needed consider to use the <code>MicroDAQ</code> module. In order use the Server history create a <code>ServerHistory</code> module. All variables that have the correct tag (default: "history") will be added to the Server history. The history length is set during module construction and fixed per module. Every time one of the variable handled by the history module is updated it will be filled into the history buffer. The buffer length (history length) can not be changed during runtime. Finally, one can create an additional buffer for each history buffer that includes the time stamps of each data point in the history buffer. This is useful if not all history buffers are filled with the same rate or the rate is not known.</p>
<p>Output variables created by the <code>ServerHistory</code> module are named like their feeding process variables with a prefixed name that is set when the process variables is added to the history module. In case of Array type feeding process variables n history buffers are created (where n is the Array size) and the element index i is appended to the feeding process variable name. In consequence an input array of length i will result in i output history arrays. The following tags are added to the history output variable:</p><ul>
<li>Name of the history module with the suffix "_internal" appended</li>
</ul>
<p>The connection of variables with the 'history' tag to the ServerHistory module is done automatically. </p><dl class="section attention"><dt>Attention</dt><dd>Only variables of modules defined before constructing the ServerHistory module are considered.</dd></dl>
<p>It is also possible to connect a DeviceModule to the ServerHistory module. Variables of Devices have no tags and therefor they will not be automatically connected to the SereverHistory module. One has to call addSource(). In addition a trigger in case the variables are not push type. It has to be set when constructing the DeviceModule. If the device variables are writable they are of push type. In this case the trigger will not be added. One has to use the LogicalNameMapping backend to force the device variables to be read only by using the <code>forceReadOnly</code> plugin. Using the LogicalNameMapping backend also allows to select individual device process variables to be connected to the <code>ServerHistory</code>.</p>
<p>The following example shows how to integrate the <code>ServerHistory</code> module. </p><div class="fragment"><div class="line"> sruct TestModule: <span class="keyword">public</span> ChimeraTK::ApplicationModule{</div>
<div class="line"> chimeraTK::ScalarOutput&lt;float&gt; measurement{<span class="keyword">this</span>, <span class="stringliteral">&quot;measurement&quot;</span>, <span class="stringliteral">&quot;&quot;</span> ,</div>
<div class="line"><span class="stringliteral">&quot;measurement variable&quot;</span>, {<span class="stringliteral">&quot;history&quot;</span>}};</div>
<div class="line"> ...</div>
<div class="line"> };</div>
<div class="line"> <span class="keyword">struct </span>myApp : <span class="keyword">public</span> ChimeraTK::Application{</div>
<div class="line"> </div>
<div class="line"> history::ServerHistory history{<span class="keyword">this</span>, <span class="stringliteral">&quot;ServerHistory&quot;</span>, <span class="stringliteral">&quot;History module&quot;</span>, 20}; <span class="comment">// History buffer length is 20</span></div>
<div class="line"> </div>
<div class="line"> ChimeraTK::DeviceModule dev{<span class="keyword">this</span>, <span class="stringliteral">&quot;Dummy&quot;</span>, <span class="stringliteral">&quot;Trigger/tick&quot;</span>};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> TestModule test{ <span class="keyword">this</span>, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;&quot;</span> };</div>
<div class="line"> ...</div>
<div class="line"> };</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> <span class="keywordtype">void</span> myAPP::myAPP(){</div>
<div class="line"> <span class="comment">// The variable of the TestModule will show up in the control system as history/test/measurement automatically</span></div>
<div class="line">(identified by the tag).</div>
<div class="line"> <span class="comment">// Add a device. Updating of the history buffer is trigger external by the given trigger</span></div>
<div class="line"> history.addSource(&amp;ev);</div>
<div class="line"> ...</div>
<div class="line"> }</div>
</div><!-- fragment --><dl class="section remark"><dt>Remarks</dt><dd>Before starting the main loop of the server history module <code>readAnyGroup()</code> is called. This seems to block until all connected variables are written once. So if the history buffers are not filled make sure all variables are written. If they are not written in the module main loop, write them once before the main loop of the module containing the history variables. </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Aug 22 2024 21:40:57 for ChimeraTK-ApplicationCore-ServerHistoryModule by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
