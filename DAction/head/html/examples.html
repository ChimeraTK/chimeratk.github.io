<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DAction: Examples</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ChimeraTK_Logo_whitebg.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DAction
   &#160;<span id="projectnumber">03.01.00</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('examples.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Examples </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#dfctextended">Using D_fct extensions</a></li>
<li class="level1"><a href="#actionusage">Set Action to your properties</a></li>
<li class="level1"><a href="#actionwriting">Writing your own ActionBase derivative class</a></li>
</ul>
</div>
<div class="textblock"><p>This page enlists the common and recommended usage of the library. For detailed idea surrouding the architecture and design patterns used in the library, head to <a class="el" href="description.html">Description</a> page.</p>
<h1><a class="anchor" id="dfctextended"></a>
Using D_fct extensions</h1>
<p>To enable usage of the <a class="el" href="class_d__fct_extended.html" title="A class that implements the component pattern design in DOOCS properties.">D_fctExtended</a> classes, simply include the class:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;DAction/D_fctExtended.h&gt;</span></div>
<div class="line"><span class="comment">// Use this one if you need some array-like properties</span></div>
<div class="line"><span class="preprocessor">#include &lt;DAction/D_fctarrayExtended.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>YourEqFct : EqFct {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"><span class="comment">// ...before...</span></div>
<div class="line">D_float voltage;</div>
<div class="line">D_int numberOfChannels;</div>
<div class="line">D_string nameOfYourPet;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ...after...</span></div>
<div class="line"><a class="code" href="class_d__fct_extended.html">D_fctExtended&lt;D_float, float&gt;</a> voltage;</div>
<div class="line"><a class="code" href="class_d__fct_extended.html">D_fctExtended&lt;D_int, int&gt;</a>   numberOfChannels;</div>
<div class="line"><a class="code" href="class_d__fct_extended.html">D_fctExtended&lt;D_string, const char *&gt;</a> nameOfYourPet;</div>
<div class="line">};</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The constructor and functionality stays exactly the same as previously if you decide not to do anything else with your newly-declared properties.</dd></dl>
<h1><a class="anchor" id="actionusage"></a>
Set Action to your properties</h1>
<p>The main idea behind the change is to inject a component called Action, that fulfills the interface of <a class="el" href="class_action_base.html" title="Base class providing an interface for onGet/onSet component.">ActionBase</a> class by implementing onGetProtected and onSetProtected methods. This allows automation of triggering the action when set_value() and value() methods are called (either internally or externally).</p>
<div class="fragment"><div class="line"><span class="comment">// Do not fear about the &quot;new&quot; directive, internally boost:shared_ptr is used.</span></div>
<div class="line">voltage.setAction(<span class="keyword">new</span> ActionDevAccessDummyDevice&lt;float&gt;(<span class="comment">/*...constructorParameters...*/</span>));</div>
<div class="line">numberOfChannels.setAction(<span class="keyword">new</span> ActionDevAccessDummyDevice&lt;int&gt;(<span class="comment">/*...constructorParameters...*/</span>));</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// during update() or interrupt_usr1()</span></div>
<div class="line">(void) voltage.value(); <span class="comment">// invoked only to trigger onGet(), which is meant to update the property value with device data</span></div>
<div class="line">(void) numberOfChannels.value(); </div>
</div><!-- fragment --><p>You may wonder what happened to set_value() method and why it is not mentioned. The reason for that is that it is triggered during an RPC call when requested from jddd panel - and therefore onSet() is triggered asynchronously without our need to check for any changes.</p>
<h1><a class="anchor" id="actionwriting"></a>
Writing your own ActionBase derivative class</h1>
<p>The simplest derivative class includes implementation for abstract methods onGetProtected() and onSetProtected(). The template looks as follows:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef ActionDerivative_h</span></div>
<div class="line"><span class="preprocessor">#define ActionDerivative_h</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_action_base_8h.html">ActionBase.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keyword">class </span>ActionDerivative : <span class="keyword">public</span> <a class="code" href="class_action_base.html">ActionBase</a>&lt;T&gt; {</div>
<div class="line">    </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    ActionDerivative();</div>
<div class="line">    <span class="keyword">virtual</span> ~ActionDerivative();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_action_base.html#a4bb7c2484e4afcb6ba55c07725bc0a9e">onSetProtected</a>(boost::any val);</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_action_base.html#aa0ed480cacd3d5e5ca3e45d6e068123b">onGetProtected</a>(boost::any&amp; val);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line">ActionDerivative&lt;T&gt;::ActionDerivative() {}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line">ActionDerivative&lt;T&gt;::~ActionDerivative() {</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keywordtype">void</span> ActionDerivative&lt;T&gt;::onSetProtected(boost::any val) {</div>
<div class="line">  T value = boost::any_cast&lt;T&gt;(val);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// ... set something with the value you have just obtained ...</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keywordtype">void</span> ActionDerivative&lt;T&gt;::onGetProtected(boost::any&amp; val) {</div>
<div class="line"> </div>
<div class="line">  T valueFromSomeOtherSource;</div>
<div class="line">  <span class="comment">// ... get some value to be updated in a property ...</span></div>
<div class="line"> </div>
<div class="line">  val = (T) valueFromSomeOtherSource;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif  </span><span class="comment">/* ActionDerivative_h */</span><span class="preprocessor"></span></div>
</div><!-- fragment --><p>The code above should serve as a good basis, but other functionality, as introducing limiter, converters, or other types of data manipulation, can be implemented there as well. For reference, please check the source code for ActionDevAccessDummyDevice class. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="aclass_action_base_html_aa0ed480cacd3d5e5ca3e45d6e068123b"><div class="ttname"><a href="class_action_base.html#aa0ed480cacd3d5e5ca3e45d6e068123b">ActionBase::onGetProtected</a></div><div class="ttdeci">virtual void onGetProtected(boost::any &amp;val)=0</div></div>
<div class="ttc" id="aclass_d__fct_extended_html"><div class="ttname"><a href="class_d__fct_extended.html">D_fctExtended</a></div><div class="ttdoc">A class that implements the component pattern design in DOOCS properties.</div><div class="ttdef"><b>Definition:</b> <a href="_d__fct_extended_8h_source.html#l00028">D_fctExtended.h:28</a></div></div>
<div class="ttc" id="aclass_action_base_html_a4bb7c2484e4afcb6ba55c07725bc0a9e"><div class="ttname"><a href="class_action_base.html#a4bb7c2484e4afcb6ba55c07725bc0a9e">ActionBase::onSetProtected</a></div><div class="ttdeci">virtual void onSetProtected(boost::any val)=0</div></div>
<div class="ttc" id="aclass_action_base_html"><div class="ttname"><a href="class_action_base.html">ActionBase</a></div><div class="ttdoc">Base class providing an interface for onGet/onSet component.</div><div class="ttdef"><b>Definition:</b> <a href="_action_base_8h_source.html#l00011">ActionBase.h:11</a></div></div>
<div class="ttc" id="a_action_base_8h_html"><div class="ttname"><a href="_action_base_8h.html">ActionBase.h</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Aug 27 2024 22:30:18 for DAction by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
