<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ChimeraTK-DeviceAccess: Technical specification: Mapping of DataConsistencyKeys to VersionNumbers V0.0WIP</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="ChimeraTK_Logo_whitebg.png"/></td>
  <td id="projectalign">
   <div id="projectname">ChimeraTK-DeviceAccess<span id="projectnumber">&#160;03.21.00</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('spec__data_consistency_key_mapping.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Technical specification: Mapping of DataConsistencyKeys to VersionNumbers V0.0WIP</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="autotoc_md1"></a>
A. Introduction</h2>
<p>The <a class="el" href="class_chimera_t_k_1_1_data_consistency_group.html" title="Group several registers (= TransferElement) which ensures data consistency across multiple variables ...">DataConsistencyGroup</a> allows to ensure consistency of the values read through different accessors. For this matching, the <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a> is used as a key. The <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a> is only valid within the same <a class="el" href="namespace_chimera_t_k.html">ChimeraTK</a> application process, so when transporting data via a <a class="el" href="class_chimera_t_k_1_1_device_backend.html" title="The base class for backends providing IO functionality for the Device class.">DeviceBackend</a>, the VersionNumbers have to be mapped to/from some other key, such as the DOOCS Event ID or a timestamp. This key can either be shipped as metadata attached to the payload data, if this is foreseen in the protocol (as e.g. in the case of DOOCS), or it may be shipped in a separate register (as e.g. in case of an XDMA device with an interrupt).</p>
<p>In this document, the exact behaviour of this mapping is specified and the architecture of the implementation is laid out. Please note, only the read direction is for now covered by the implementation and this specification.</p>
<p>Note: Albeit gramatically incorrect, plural forms of class names are written with apostrophes throughout this document, so the class name is properly highlighted by Doxygen and linked to the class documentation.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
B. Behavioural specification</h2>
<ul>
<li>1. The <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_realm.html">DataConsistencyRealm</a> is a mapping of <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a> to <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a><ul>
<li>1.2 It has a name used to identify the <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_realm.html">DataConsistencyRealm</a>, which may consist of alphanumeric characters only.</li>
<li>1.3. Each entity (backend, accessor etc.) which needs to map an incoming <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a> to a <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a> needs to get the appropriate <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_realm.html">DataConsistencyRealm</a> from the <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_realm_store.html">DataConsistencyRealmStore</a> singleton.</li>
<li>1.4. All entities whose incoming <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a>'s have values which are comparable to each other (c.f. <a class="el" href="spec__data_consistency_key_mapping.html#dataConsistencyKeyMapping_B_2">B.2</a>) shall use the same <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_realm.html">DataConsistencyRealm</a> to ensure consistency across entities.</li>
</ul>
</li>
<li>2.<a class="anchor" id="dataConsistencyKeyMapping_B_2"></a> The <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a> is a uint64_t value which is used as a key value.<ul>
<li>2.2. The value is a key for sorting incoming data, also across different registers and even devices using the same <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_realm.html">DataConsistencyRealm</a>, in time.<ul>
<li>2.2.1 Older data has smaller <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a>'s and will be attached with a smaller <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a>.</li>
<li>2.2.2 Newer data has greater <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a>'s and will be attached with a greater <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a>.</li>
<li>2.2.3 Data with identical <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a>'s is considered to be consistent and will be attached with the same <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a>.</li>
<li>2.3.4 <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a>'s need to be approximately consecutive, with no big gaps between consecutivly incoming data.</li>
</ul>
</li>
</ul>
</li>
<li>3. <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a> &lt;=&gt; <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">ChimeraTK::VersionNumber</a> mapping (in the <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_realm.html">DataConsistencyRealm</a>)<ul>
<li>Requirements from other specifications:<ul>
<li>No <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a>{nullptr} is given out after the first successful transfer. (FIXME Reference)</li>
<li>All version numbers must not be older than the global version number at the time <a class="el" href="class_chimera_t_k_1_1_device_backend.html#a9da6866e3f0b481e1fcc13985382f5f9" title="Open the device.">DeviceBackend::open()</a> was called. (FIXME Reference)</li>
<li><a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a>'s are never decreasing in the same <a class="el" href="class_chimera_t_k_1_1_transfer_element.html" title="Base class for register accessors which can be part of a TransferGroup.">TransferElement</a>. (FIXME Reference)</li>
</ul>
</li>
<li>3.1 A <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_realm.html">DataConsistencyRealm</a> is used across all backend instances to allow consistent VersionNumbers across backends<ul>
<li>3.1.1<a class="anchor" id="DataConsistencyKeyMapping_B_3_1_1"></a> The <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a> for <code><a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a>=0</code> is always <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a>{nullptr}. It is not added to the map.</li>
<li>3.1.2 If a <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a> is in the map, the according <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a> is returned by the realm.</li>
<li>3.1.3 If a <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a> is newer than the newest entry in the map, a new <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a> is generated and it is added to the map.<ul>
<li>3.1.3.1<a class="anchor" id="DataConsistencyKeyMapping_B_3_1_3_1"></a> The size of the map is limited to avoid infitely increasing memory for long-running servers<ul>
<li>3.1.3.1.1 If the map has reached the maximum size, the oldest entries are removed</li>
<li>3.1.3.1.2<a class="anchor" id="DataConsistencyKeyMapping_B_3_1_3_1_2"></a> If a <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a> is older that the oldest entry in the map, <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a>{nullptr} is returned</li>
<li>3.1.3.1.3 Optional extension: The size can be configured via the CDD. TBD: How to deal with conflicting sizes? Take the maximum?</li>
</ul>
</li>
<li>3.1.3.2<a class="anchor" id="DataConsistencyKeyMapping_B_3_1_3_2"></a> Whenever a new <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a> is added to the map, all <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a>'s between the newest <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a> in the map and the incoming <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a> are added to the map as well. This guarantees that a larger <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a> always has a larger <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a>, even if <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a>'s are not created in increasing order. <a class="el" href="spec__data_consistency_key_mapping.html#DataConsistencyKeyMapping_comment_B_3_1_3_2">(*)</a></li>
<li>3.1.3.3 If the first <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a> is added to the still-empty map, the map is filled with keys before the incoming key, up to the maximum size of the map acording to <a class="el" href="spec__data_consistency_key_mapping.html#DataConsistencyKeyMapping_B_3_1_3_1">3.1.3.1</a>. 3.1.4<a class="anchor" id="DataConsistencyKeyMapping_B_3_1_4"></a>As described in <a class="el" href="spec__data_consistency_key_mapping.html#DataConsistencyKeyMapping_B_3_1_1">3.1.1</a> and <a class="el" href="spec__data_consistency_key_mapping.html#DataConsistencyKeyMapping_B_3_1_3_1_2">3.1.3.1.2</a>, the realm may hand out <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a>{nullptr}, which must never be written to a <a class="el" href="class_chimera_t_k_1_1_transfer_element.html" title="Base class for register accessors which can be part of a TransferGroup.">TransferElement</a>. <a class="el" href="spec__data_consistency_key_mapping.html#DataConsistencyKeyMapping_B_3_3_3_1">3.3.3.1</a> and <a class="el" href="spec__data_consistency_key_mapping.html#DataConsistencyKeyMapping_B_3_3_3_2">3.3.3.2</a> describe how this is ensured. For these data matching via the <a class="el" href="class_chimera_t_k_1_1_data_consistency_group.html" title="Group several registers (= TransferElement) which ensures data consistency across multiple variables ...">DataConsistencyGroup</a> may not be possible or lead to false matches.</li>
</ul>
</li>
</ul>
</li>
<li>3.2<a class="anchor" id="DataConsistencyKeyMapping_B_3_2"></a> When <a class="el" href="class_chimera_t_k_1_1_device_backend.html#a9da6866e3f0b481e1fcc13985382f5f9" title="Open the device.">DeviceBackend::open()</a> is called, a startVersionNumber is created.<ul>
<li>3.2.1<a class="anchor" id="DataConsistencyKeyMapping_B_3_2_1"></a> No version number smaller than the startVersionNumber is handed out from this point in time.</li>
<li>3.2.2 It is the responsibility of each backend implementation to do this correct. The <a class="el" href="class_chimera_t_k_1_1_numeric_addressed_backend.html" title="Base class for address-based device backends (e.g.">NumericAddressedBackend</a> will already take care of this.</li>
</ul>
</li>
<li>3.3 RegisterAccessors get the <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a> from the <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_realm.html">DataConsistencyRealm</a>, according to the incoming <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a><ul>
<li>3.3.1 Each <a class="el" href="class_chimera_t_k_1_1_transfer_element.html" title="Base class for register accessors which can be part of a TransferGroup.">TransferElement</a> implementation needs to store the last used <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a>.</li>
<li>3.3.2 If the incoming <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a> results in a smaller <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a> than last used:<ul>
<li>the last used <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a> is attached to the data</li>
<li>DataValidity is set to <a class="el" href="namespace_chimera_t_k.html#a9a7d226a45242c6825eb7a26235298dfac4ef1e7ec5c765839c8acdd9968542b2" title="The data is considered valid.">DataValidity::faulty</a></li>
</ul>
</li>
<li>3.3.3 If the incoming <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a> results in a <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a> larger or equal to the last used <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a>:<ul>
<li>3.3.3.1<a class="anchor" id="DataConsistencyKeyMapping_B_3_3_3_1"></a> If that incoming <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a> is smaller than the startVersionNumber (see <a class="el" href="spec__data_consistency_key_mapping.html#DataConsistencyKeyMapping_B_3_2">3.2</a>), the startVersionNumber is used instead (c.f. <a class="el" href="spec__data_consistency_key_mapping.html#DataConsistencyKeyMapping_B_3_2_1">3.2.1</a>). This does not set the DataValidity to <a class="el" href="namespace_chimera_t_k.html#a9a7d226a45242c6825eb7a26235298dfac4ef1e7ec5c765839c8acdd9968542b2" title="The data is considered valid.">DataValidity::faulty</a>. <a class="el" href="spec__data_consistency_key_mapping.html#DataConsistencyKeyMapping_comment_B_3_3_3_1">(*)</a></li>
<li>3.3.3.2<a class="anchor" id="DataConsistencyKeyMapping_B_3_3_3_2"></a> If the <code>max(incomingVersionNumber,startVersionNumber)</code> is smaller than the last used <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a>:<ul>
<li>the last used <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a> is attached to the data</li>
<li>DataValidity is set to <a class="el" href="namespace_chimera_t_k.html#a9a7d226a45242c6825eb7a26235298dfac4ef1e7ec5c765839c8acdd9968542b2" title="The data is considered valid.">DataValidity::faulty</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md3"></a>
Comments</h3>
<ul>
<li><a class="anchor" id="DataConsistencyKeyMapping_comment_B_3_1_3_2"></a><a class="el" href="spec__data_consistency_key_mapping.html#DataConsistencyKeyMapping_B_3_1_3_2">3.1.3.2</a> This can happen since the first time a particular key is encountered may happen on different variables and even backends each time.</li>
<li><a class="anchor" id="DataConsistencyKeyMapping_comment_B_3_1_4"></a><a class="el" href="spec__data_consistency_key_mapping.html#DataConsistencyKeyMapping_B_3_1_4">3.1.4</a> Giving out a <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a>{nullptr} would violate the DeviceAccess <a class="el" href="class_chimera_t_k_1_1_transfer_element.html" title="Base class for register accessors which can be part of a TransferGroup.">TransferElement</a> specification.</li>
<li><a class="anchor" id="DataConsistencyKeyMapping_comment_B_3_3_3_1"></a><a class="el" href="spec__data_consistency_key_mapping.html#DataConsistencyKeyMapping_B_3_3_3_1">3.3.3.1</a> This is the case for <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a>{nullptr} and valid <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a>'s which have been created before calling open() of the backend.</li>
</ul>
<h2><a class="anchor" id="autotoc_md4"></a>
C. Implementation for the AsyncNDRegisterAccessor</h2>
<p>The following diagram shows the integration of the <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_realm.html">DataConsistencyRealm</a> with the <a class="el" href="class_chimera_t_k_1_1async_1_1_async_n_d_register_accessor.html" title="The AsyncNDRegisterAccessor implements a data transport queue with typed data as continuation of the ...">AsyncNDRegisterAccessor</a> and <a class="el" href="class_chimera_t_k_1_1async_1_1_async_accessor_manager.html" title="The AsyncAccessorManager has three main functionalities:">AsyncAccessorManager</a> concept. The diagram is not complete and shows only the relevant parts. New classes and new or modified class members are shown in red.</p>
<p>(Hint: Hover the mouse cursor over edge labels "see tooltip" to show the description.)</p>
<div class="dotgraph">
<iframe scrolling="no" frameborder="0" src="dot_inline_dotgraph_5.svg" width="616" height="58"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
<div class="dotgraph">
<iframe scrolling="no" frameborder="0" src="dot_inline_dotgraph_6.svg" width="2123" height="1028"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
<ul>
<li>1. The global singleton <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_realm_store.html">DataConsistencyRealmStore</a> is the factory for the <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_realm.html">DataConsistencyRealm</a>'s.<ul>
<li>1.1. The <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_realm_store.html">DataConsistencyRealmStore</a> will keep track of the created <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_realm.html">DataConsistencyRealm</a>'s internally, so it hands out the same <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_realm.html">DataConsistencyRealm</a> for the same realmName, as long as the realm still exists.</li>
<li>1.2. The <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_realm_store.html">DataConsistencyRealmStore</a> stores only weak_ptr of the realm objects. If a realm is no longer used, it will be cleaned up (so the <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a> mapping is forgotten).</li>
</ul>
</li>
<li>2. Backends, like the DoocsBackend (called "SomeNonNumericAddressedBackend" in the above graph), which have their <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a> value shipped together with the payload data in their protocol, need to obey the following rules in their event handler (called <code>handleEvent()</code> in the above graph, although the naming and structure may be vastly different for actual implementations):<ul>
<li>2.1. Such backends will typically use a fixed realm name, which should clearly refer to the protocol (e.g. "doocsEventId" in case of the DoocsBackend).<ul>
<li>2.1.1. The realm name should be overrideable through a CDD parameter.</li>
</ul>
</li>
<li>2.2. The event handler needs to extract the <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a> from incoming data when an event is received.</li>
<li>2.3. It shall then translate the key into the corresponding <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a> through the <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_realm.html">DataConsistencyRealm</a>, and pass the <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a> to <a class="el" href="class_chimera_t_k_1_1async_1_1_domain_impl.html#a5d828baec6fc47134d01449f700b209e" title="Distribute the data via the associated distribution tree.">async::DomainImpl::distribute()</a>.</li>
</ul>
</li>
<li>3. Backends, like the <a class="el" href="class_chimera_t_k_1_1_numeric_addressed_backend.html" title="Base class for address-based device backends (e.g.">NumericAddressedBackend</a>, which are using the poll mechanism of the <a class="el" href="design__async_n_d_register_accessor__numeric_addressed.html">AsyncNDRegisterAccessor concept</a> (i.e. the <a class="el" href="class_chimera_t_k_1_1async_1_1_triggered_poll_distributor.html" title="The TriggeredPollDistributor has std::nullptr_t source data type and is polling the data for the Asyn...">TriggeredPollDistributor</a>), need to provide the necessary information through the catalogue and can otherwise rely on the framework implementation:<ul>
<li>3.1. The <a class="el" href="class_chimera_t_k_1_1_backend_register_catalogue_base.html" title="Pure virtual implementation base class for the register catalogue.">BackendRegisterCatalogueBase</a> contains a map of <a class="el" href="design__async_n_d_register_accessor__numeric_addressed.html#AsyncNDRegisterAccessor_qualifiedAsyncSubDomainID">qualifiedAsyncSubDomainID</a> to <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_realm.html">DataConsistencyRealm</a> names.</li>
<li>3.2. The CDD can contain a parameter "DataConsistencyKeys" to define the registers with the <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_key.html">DataConsistencyKey</a> values.<ul>
<li>3.2.1. These registers need to be triggered each by a different interrupt.</li>
<li>3.2.2. The CDD parameter "DataConsistencyKeys" contains a JSON object, where each JSON key is interpreted as the register path and each value as the corresponding realm name.</li>
<li>3.2.3. Based on this information, the <a class="el" href="class_chimera_t_k_1_1_numeric_addressed_backend.html" title="Base class for address-based device backends (e.g.">NumericAddressedBackend</a> will fill the BackendRegisterCatalogueBase::_dataConsistencyRealmIdMap</li>
</ul>
</li>
<li>3.3. Future map file formats will also allow specifying such pairs of key registers and realm names.</li>
<li>3.4. The <a class="el" href="class_chimera_t_k_1_1async_1_1_triggered_poll_distributor.html" title="The TriggeredPollDistributor has std::nullptr_t source data type and is polling the data for the Asyn...">TriggeredPollDistributor</a><ul>
<li>3.4.1. obtains the <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_realm.html">DataConsistencyRealm</a> and the key register path from the <a class="el" href="class_chimera_t_k_1_1_backend_register_catalogue.html" title="Interface for backends to the register catalogue.">BackendRegisterCatalogue</a> in its constructor, based on its owners subdomain ID,</li>
<li>3.4.2. adds the accessor for the key register path to its <a class="el" href="class_chimera_t_k_1_1_transfer_group.html" title="Group multiple data accessors to efficiently trigger data transfers on the whole group.">TransferGroup</a>,</li>
<li>3.4.3. fetches the key valye in <a class="el" href="class_chimera_t_k_1_1async_1_1_triggered_poll_distributor.html#a82f6095278727c5e39c7a85deb577e3c" title="Poll all sync variables.">TriggeredPollDistributor::prepareIntermediateBuffers()</a> (via <a class="el" href="class_chimera_t_k_1_1_transfer_group.html#af8df339d4a0700087e48d57223231d88" title="Trigger read transfer for all accessors in the group.">TransferGroup::read()</a>), and translates it into a <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a> using the <a class="el" href="class_chimera_t_k_1_1async_1_1_data_consistency_realm.html">DataConsistencyRealm</a>,</li>
<li>3.4.4. keeps track of the last <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a> it has sent out:<ul>
<li>3.4.4.1. Only if the <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a> matching the incoming key value is greater or equal the last sent <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a>, the new <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a> will be used.</li>
<li>3.4.4.2. If the new <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a> is smaller then the last one, the last <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a> is sent out and the DataValidity is forced to <a class="el" href="namespace_chimera_t_k.html#a9a7d226a45242c6825eb7a26235298dfac4ef1e7ec5c765839c8acdd9968542b2" title="The data is considered valid.">DataValidity::faulty</a>.</li>
<li>3.4.4.3. "Using" the new <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a> in this context means to set <a class="el" href="class_chimera_t_k_1_1async_1_1_source_typed_async_accessor_manager.html#af62830915cac271e4f65cf7ea6bdfeb0">SourceTypedAsyncAccessorManager::_version</a> to the new version, so the subsequent distribution of values to the <a class="el" href="struct_chimera_t_k_1_1async_1_1_async_variable.html" title="Typeless base class.">AsyncVariable</a>'s uses this <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a>.</li>
</ul>
</li>
</ul>
</li>
<li>3.5. <a class="el" href="class_chimera_t_k_1_1async_1_1_source_typed_async_accessor_manager.html#aa0a63af85df1f1b58cab59df45d1dba9" title="Distribute the given data to the subsribers.">SourceTypedAsyncAccessorManager::distribute()</a> will return its <a class="el" href="class_chimera_t_k_1_1async_1_1_source_typed_async_accessor_manager.html#af62830915cac271e4f65cf7ea6bdfeb0">SourceTypedAsyncAccessorManager::_version</a> (after it has potentially been modified in <a class="el" href="class_chimera_t_k_1_1async_1_1_triggered_poll_distributor.html#a82f6095278727c5e39c7a85deb577e3c" title="Poll all sync variables.">TriggeredPollDistributor::prepareIntermediateBuffers()</a>) to the calling <a class="el" href="class_chimera_t_k_1_1async_1_1_sub_domain.html#aeab2f0c008fe544e72c42a4176f85195">SubDomain::distribute()</a>.</li>
<li>3.6. <a class="el" href="class_chimera_t_k_1_1async_1_1_sub_domain.html#aeab2f0c008fe544e72c42a4176f85195">SubDomain::distribute()</a> calls <a class="el" href="class_chimera_t_k_1_1async_1_1_source_typed_async_accessor_manager.html#aa0a63af85df1f1b58cab59df45d1dba9" title="Distribute the given data to the subsribers.">TriggeredPollDistributor::distribute()</a> first and update its local <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a>, so a potential following <a class="el" href="class_chimera_t_k_1_1async_1_1_source_typed_async_accessor_manager.html#aa0a63af85df1f1b58cab59df45d1dba9" title="Distribute the given data to the subsribers.">VariableDistributor::distribute()</a> will use the same <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a> as the <a class="el" href="class_chimera_t_k_1_1async_1_1_triggered_poll_distributor.html" title="The TriggeredPollDistributor has std::nullptr_t source data type and is polling the data for the Asyn...">TriggeredPollDistributor</a>.</li>
<li>3.6.1. This ensures that a register which is polled by an interrupt will have a matching <a class="el" href="class_chimera_t_k_1_1_version_number.html" title="Class for generating and holding version numbers without exposing a numeric representation.">VersionNumber</a> as the void-typed interrupt itself. </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
