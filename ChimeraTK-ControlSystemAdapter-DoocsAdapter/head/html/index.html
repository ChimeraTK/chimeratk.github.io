<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ChimeraTK-ControlSystemAdapter-DoocsAdapter: ChimeraTK-ControlSystemAdapter-DoocsAdapter</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ChimeraTK_Logo_whitebg.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ChimeraTK-ControlSystemAdapter-DoocsAdapter
   &#160;<span id="projectnumber">01.11.03</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ChimeraTK-ControlSystemAdapter-DoocsAdapter </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The ChimeraTK-ControlSystemAdapter-DoocsAdapter implements the ChimeraTK Control System Adapter for DOOCS.</p>
<h1><a class="anchor" id="Integration"></a>
Integrating your control system application into DOOCS</h1>
<p>Prerequisites: </p><ul>
<li>The application has been writen with the ChimeraTK-ApplicationCore library, </li>
<li>a working DOOCS environment (see: <a href="http://doocs.desy.de">http://doocs.desy.de</a>).</li>
</ul>
<p>To integrate the application into DOOCS, it has to be linked against the ChimeraTK-ControlSystemAdapter-DoocsAdapter library. Simply use the <code>add_dependency()</code> cmake macro coming with the ChimeraTK project template, then add <code>${ChimeraTK-ControlSystemAdapter-DoocsAdapter_LINK_FLAGS}</code> to the <code>CMAKE_LINK_FLAGS</code> and <code>${ChimeraTK-ControlSystemAdapter-DoocsAdapter_LIBRARIES}</code> to the libraries your executable links against. It is not necessary to change the include path.</p>
<p>In addition, several configuration files have to be provided to your executable at runtime.</p>
<h2><a class="anchor" id="DOOCS_config"></a>
DOOCS configuration file</h2>
<p>Firstly, all DOOCS servers require the usual DOOCS <code>servername.conf</code> file. A simple example for this file is this: </p><div class="fragment"><div class="line">eq_conf:</div>
<div class="line"> </div>
<div class="line">oper_uid:       -1</div>
<div class="line">oper_gid:       405</div>
<div class="line">xpert_uid:      1000</div>
<div class="line">xpert_gid:      1000</div>
<div class="line">ring_buffer:    10000</div>
<div class="line">memory_buffer:  500</div>
<div class="line"> </div>
<div class="line">eq_fct_name:    &quot;PLAIN_VARIABLE_CREATION_TEST._SVR&quot;</div>
<div class="line">eq_fct_type:    1</div>
<div class="line">{</div>
<div class="line">SVR.RPC_NUMBER:         700000006</div>
<div class="line">SVR.NAME:       &quot;PLAIN_VARIABLE_CREATION_TEST._SVR&quot;</div>
<div class="line">SVR.BPN:        6000</div>
<div class="line">}</div>
<div class="line">eq_fct_name:    &quot;INT&quot;</div>
<div class="line">eq_fct_type:    10</div>
<div class="line">{</div>
<div class="line">NAME:   &quot;INT&quot;</div>
<div class="line">}</div>
<div class="line">eq_fct_name:    &quot;SHORT&quot;</div>
<div class="line">eq_fct_type:    10</div>
<div class="line">{</div>
<div class="line">NAME:   &quot;SHORT&quot;</div>
<div class="line">}</div>
<div class="line">eq_fct_name:    &quot;FLOAT&quot;</div>
<div class="line">eq_fct_type:    10</div>
<div class="line">{</div>
<div class="line">NAME:   &quot;FLOAT&quot;</div>
<div class="line">}</div>
<div class="line">eq_fct_name:    &quot;DOUBLE&quot;</div>
<div class="line">eq_fct_type:    10</div>
<div class="line">{</div>
<div class="line">NAME:   &quot;DOUBLE&quot;</div>
<div class="line">}</div>
<div class="line">eq_fct_name:    &quot;UINT&quot;</div>
<div class="line">eq_fct_type:    10</div>
<div class="line">{</div>
<div class="line">NAME:   &quot;UINT&quot;</div>
<div class="line">}</div>
<div class="line">eq_fct_name:    &quot;USHORT&quot;</div>
<div class="line">eq_fct_type:    10</div>
<div class="line">{</div>
<div class="line">NAME:   &quot;USHORT&quot;</div>
<div class="line">}</div>
<div class="line">eq_fct_name:    &quot;CHAR&quot;</div>
<div class="line">eq_fct_type:    10</div>
<div class="line">{</div>
<div class="line">NAME:   &quot;CHAR&quot;</div>
<div class="line">}</div>
<div class="line">eq_fct_name:    &quot;UCHAR&quot;</div>
<div class="line">eq_fct_type:    10</div>
<div class="line">{</div>
<div class="line">NAME:   &quot;UCHAR&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Replace the RPC number with the number corresponding to your application. You should also change the uid/gid numbers and the name of the server location according to your needs. Finally, you need to have entries for all locations your server should provide. Since the location is a concept which is introduced by DOOCS, the application does not directly define them. Hence, you need to provide a second configuration file which defines how the variable household provided by your application should be mapped to the DOOCS structure.</p>
<p>All locations have the same <code>eq_fct_type</code> 10. As DOOCS will add the properties inside the locations automatically, you do not have to specify them here.</p>
<p>Missing locations will also be added automatically by the adapter, so it is perfectly fine to just have the server location in the config file. Deflaut <code>eq_fct_type</code> is 10, but you can set a new <code>code</code> corresponding to <code>eq_fct_type</code>, see <a class="el" href="index.html#specifie_code">Specify <code>eq_fct_code</code> in the mapping file</a>.</p>
<h2><a class="anchor" id="mapping_file"></a>
DOOCS adapter mapping file</h2>
<p>The mapping of the application variable household on to the DOOCS structure is done with a XML file. The file has to be called <code>applicationName-DoocsVariableConfig.xml</code> (replace <code>applicationName</code> with the name of your application).</p>
<p>If this file is omitted, all variables will be exported to DOOCS, with the highest hierarchy level becoming the location name, and the other levels being converted into a dot-separated property name (i.e. /Module2/SubModule3/property7 becomes DOOCS property //Module2/SubModule3.property7).</p>
<p>An example for the mapping file is:</p>
<div class="fragment"><div class="line">&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">encoding</span>=<span class="stringliteral">&quot;UTF-8&quot;</span>?&gt;</div>
<div class="line">&lt;<span class="keywordtype">device_server</span> <span class="keyword">xmlns</span>=<span class="stringliteral">&quot;https://github.com/ChimeraTK/ControlSystemAdapter-DoocsAdapter&quot;</span>&gt;</div>
<div class="line">  <span class="comment">&lt;!--Default settings for a spectrum --&gt;</span></div>
<div class="line">  &lt;<span class="keywordtype">location</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;INT&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">D_spectrum</span> <span class="keyword">source</span>=<span class="stringliteral">&quot;TO_DEVICE_ARRAY&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">D_spectrum</span> <span class="keyword">source</span>=<span class="stringliteral">&quot;FROM_DEVICE_ARRAY&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MY_RENAMED_INTARRAY&quot;</span>/&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">location</span>&gt;</div>
<div class="line"> </div>
<div class="line">  &lt;<span class="keywordtype">location</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SHORT&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">D_array</span> <span class="keyword">source</span>=<span class="stringliteral">&quot;TO_DEVICE_ARRAY&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">D_array</span> <span class="keyword">source</span>=<span class="stringliteral">&quot;FROM_DEVICE_ARRAY&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MY_RETYPED_SHORT_ARRAY&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;long&quot;</span>/&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">location</span>&gt;</div>
<div class="line">    </div>
<div class="line">  &lt;<span class="keywordtype">location</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DOUBLE&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">D_spectrum</span> <span class="keyword">source</span>=<span class="stringliteral">&quot;TO_DEVICE_ARRAY&quot;</span>/&gt;</div>
<div class="line">    <span class="comment">&lt;!--Custom spectrum settings, fixed axis arguments --&gt;</span></div>
<div class="line">    &lt;<span class="keywordtype">D_spectrum</span> <span class="keyword">source</span>=<span class="stringliteral">&quot;FROM_DEVICE_ARRAY&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">start</span>&gt;123.&lt;/<span class="keywordtype">start</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">increment</span>&gt;0.56&lt;/<span class="keywordtype">increment</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">D_spectrum</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">location</span>&gt;</div>
<div class="line"> </div>
<div class="line">  &lt;<span class="keywordtype">location</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;FLOAT&quot;</span>&gt;</div>
<div class="line">    <span class="comment">&lt;!--Dynamic axis settings --&gt;</span></div>
<div class="line">    &lt;<span class="keywordtype">D_spectrum</span> <span class="keyword">source</span>=<span class="stringliteral">&quot;TO_DEVICE_ARRAY&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">startSource</span>&gt;/<span class="keyword">FLOAT</span>/<span class="keyword">FROM_DEVICE_SCALAR</span>&lt;/<span class="keywordtype">startSource</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">incrementSource</span>&gt;/<span class="keyword">DOUBLE</span>/<span class="keyword">FROM_DEVICE_SCALAR</span>&lt;/<span class="keywordtype">incrementSource</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">D_spectrum</span>&gt;</div>
<div class="line">    <span class="comment">&lt;!--We can reuse the same axis settings --&gt;</span></div>
<div class="line">    &lt;<span class="keywordtype">D_spectrum</span> <span class="keyword">source</span>=<span class="stringliteral">&quot;FROM_DEVICE_ARRAY&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">startSource</span>&gt;/<span class="keyword">FLOAT</span>/<span class="keyword">FROM_DEVICE_SCALAR</span>&lt;/<span class="keywordtype">startSource</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">incrementSource</span>&gt;/<span class="keyword">DOUBLE</span>/<span class="keyword">FROM_DEVICE_SCALAR</span>&lt;/<span class="keywordtype">incrementSource</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">D_spectrum</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">property</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;START&quot;</span> <span class="keyword">source</span>=<span class="stringliteral">&quot;/FLOAT/TO_DEVICE_SCALAR&quot;</span>/&gt;</div>
<div class="line">    &lt;<span class="keywordtype">property</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;INCREMENT&quot;</span> <span class="keyword">source</span>=<span class="stringliteral">&quot;/DOUBLE/TO_DEVICE_SCALAR&quot;</span>/&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">location</span>&gt;</div>
<div class="line"> </div>
<div class="line">   &lt;<span class="keywordtype">location</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;UINT&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">D_spectrum</span> <span class="keyword">source</span>=<span class="stringliteral">&quot;TO_DEVICE_ARRAY&quot;</span>/&gt;</div>
<div class="line">    <span class="comment">&lt;!--Dynamic axis settings --&gt;</span></div>
<div class="line">    &lt;<span class="keywordtype">D_spectrum</span> <span class="keyword">source</span>=<span class="stringliteral">&quot;FROM_DEVICE_ARRAY&quot;</span>&gt;</div>
<div class="line">      <span class="comment">&lt;!-- it is possible to use the same startSource and incrementSource from another location --&gt;</span></div>
<div class="line">      &lt;<span class="keywordtype">startSource</span>&gt;/<span class="keyword">FLOAT</span>/<span class="keyword">FROM_DEVICE_SCALAR</span>&lt;/<span class="keywordtype">startSource</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">incrementSource</span>&gt;/<span class="keyword">DOUBLE</span>/<span class="keyword">FROM_DEVICE_SCALAR</span>&lt;/<span class="keywordtype">incrementSource</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">D_spectrum</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">location</span>&gt;</div>
<div class="line">  </div>
<div class="line">    <span class="comment">&lt;!-- This should not import the variables used for startSource and startIncrement --&gt;</span></div>
<div class="line">    &lt;<span class="keywordtype">import</span>&gt;/&lt;/<span class="keywordtype">import</span>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;/<span class="keywordtype">device_server</span>&gt;</div>
</div><!-- fragment --><p>Each location is specified with a <code>location</code> tag.The <code>location</code> tag must have one XML attribute:</p><ul>
<li><code>name</code>: Specifies the name of the location</li>
</ul>
<p>It is possible to specify the <code>eq_fct_code</code> which must match <code>eq_fct_type</code> in the configuration file, see <a class="el" href="index.html#specifie_code">Specify <code>eq_fct_code</code> in the mapping file</a>.</p><ul>
<li><code>code</code>: Optional, specifies <code>eq_fct_code</code></li>
</ul>
<p>Properties can be specified in each location with the property tag, or in case of special properties like a <code>D_spectrum</code> with the respective tag. A list of special properties is found in the next section. Each <code>property</code> tag has the following attributes:</p><ul>
<li><code>source</code>: Mandatory, specify the name of the process variable</li>
<li><code>name</code>: Optional, specify the property name. If omitted, the name is derived from the source name by replacing slashes with dots.</li>
</ul>
<h2><a class="anchor" id="import"></a>
Automatic mapping of many variables</h2>
<p>As a shortcut, the <code>import</code> tag can be used to map a large number of properties with a single command. The tag doesn't take any sub-tags but should contain a directory name of process variables, which is to be mapped recursively. If the <code>import</code> tag is specified inside a location tag, the specified process variable directory is mapped into this location. The <code>import</code> tag can also appear in the root tag, in which case the first hierarchy level will become the location name. Note that the import will only map variables which have not been mapped before by explicit mapping or other <code>import</code> tags. This is useful to map a big bulk of automatic mapping variables after picking the special cases, which needs to be mapped individually.</p>
<p>The <code>import</code> tag can take optionally one attribute:</p><ul>
<li><code>directory</code>: Add a prefix to the property names, which is separated with a dot from the rest of the property name.</li>
</ul>
<p>An example with many different automatic mappings is here: </p><div class="fragment"><div class="line">&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">encoding</span>=<span class="stringliteral">&quot;UTF-8&quot;</span>?&gt;</div>
<div class="line">&lt;<span class="keywordtype">device_server</span> <span class="keyword">xmlns</span>=<span class="stringliteral">&quot;https://github.com/ChimeraTK/ControlSystemAdapter-DoocsAdapter&quot;</span>&gt;</div>
<div class="line">  <span class="comment">&lt;!-- Test &quot;renaming&quot; a location, i.e. import something into an a location name that does not</span></div>
<div class="line"><span class="comment">       exist as directory on the input. --&gt;</span></div>
<div class="line">  &lt;<span class="keywordtype">location</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MY_RENAMED_INTEGER_LOCATION&quot;</span>&gt;</div>
<div class="line">    <span class="comment">&lt;!-- Test renaming of an array --&gt;</span></div>
<div class="line">    &lt;<span class="keywordtype">property</span> <span class="keyword">source</span>=<span class="stringliteral">&quot;/INT/CONSTANT_ARRAY&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;RENAMED.CONST_ARRAY&quot;</span>/&gt;</div>
<div class="line">    <span class="comment">&lt;!-- Test importin in this case into a location with a name different from the import--&gt;</span></div>
<div class="line">    &lt;<span class="keywordtype">import</span>&gt;/<span class="keyword">INT</span>&lt;/<span class="keywordtype">import</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">location</span>&gt;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">&lt;!-- Test &quot;Cherry picking&quot;: This location does not have an import but only hand-picked variables are in. --&gt;</span></div>
<div class="line">  &lt;<span class="keywordtype">location</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;CHERRY_PICKED&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">property</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;TO_DEVICE_SHORT&quot;</span> <span class="keyword">source</span>=<span class="stringliteral">&quot;/SHORT/TO_DEVICE_SCALAR&quot;</span>/&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">location</span>&gt;</div>
<div class="line"> </div>
<div class="line">  &lt;<span class="keywordtype">location</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SHORT&quot;</span>&gt;</div>
<div class="line">    <span class="comment">&lt;!-- Test importing and adding a &#39;directory&#39;, i.e. a dot-separated prefix to the beginning of the property name --&gt;</span></div>
<div class="line">    &lt;<span class="keywordtype">import</span> <span class="keyword">directory</span>=<span class="stringliteral">&quot;myStuff&quot;</span>&gt;/<span class="keyword">SHORT</span>&lt;/<span class="keywordtype">import</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">location</span>&gt;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">&lt;!-- Set the default for has_history to false in one location --&gt;</span></div>
<div class="line">  &lt;<span class="keywordtype">location</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;USHORT&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">has_history</span>&gt;<span class="keyword">false</span>&lt;/<span class="keywordtype">has_history</span>&gt;</div>
<div class="line">    <span class="comment">&lt;!-- Turn the history back on for one property, although the default is off.--&gt;</span></div>
<div class="line">    &lt;<span class="keywordtype">property</span> <span class="keyword">source</span>=<span class="stringliteral">&quot;TO_DEVICE_SCALAR&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">has_history</span>&gt;<span class="keyword">true</span>&lt;/<span class="keywordtype">has_history</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">property</span>&gt;</div>
<div class="line">    <span class="comment">&lt;!-- all imported properties will have the history turned off --&gt;</span></div>
<div class="line">    &lt;<span class="keywordtype">import</span>&gt;/<span class="keyword">USHORT</span>&lt;/<span class="keywordtype">import</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">location</span>&gt;    </div>
<div class="line"> </div>
<div class="line">  <span class="comment">&lt;!-- Set the default for is_writeable to false in one location.</span></div>
<div class="line"><span class="comment">       Intentionally use another location than for the has_history test to avoid missing</span></div>
<div class="line"><span class="comment">       confusion in the parser (e.g. is_writeable allways acts on both, has_history has no effec,</span></div>
<div class="line"><span class="comment">       but it&#39;s not seen because it&#39;s always tested together) --&gt;</span></div>
<div class="line">  &lt;<span class="keywordtype">location</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;UCHAR&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">is_writeable</span>&gt;<span class="keyword">false</span>&lt;/<span class="keywordtype">is_writeable</span>&gt;</div>
<div class="line">    <span class="comment">&lt;!-- Turn the history back on for one property, although the default is off.--&gt;</span></div>
<div class="line">    &lt;<span class="keywordtype">property</span> <span class="keyword">source</span>=<span class="stringliteral">&quot;TO_DEVICE_SCALAR&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">is_writeable</span>&gt;<span class="keyword">true</span>&lt;/<span class="keywordtype">is_writeable</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">property</span>&gt;</div>
<div class="line">    <span class="comment">&lt;!-- all imported properties will have the history turned off --&gt;</span></div>
<div class="line">    &lt;<span class="keywordtype">import</span>&gt;/<span class="keyword">UCHAR</span>&lt;/<span class="keywordtype">import</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">location</span>&gt;    </div>
<div class="line">  </div>
<div class="line">  &lt;<span class="keywordtype">location</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DOUBLE&quot;</span>&gt;  </div>
<div class="line">    <span class="comment">&lt;!-- test renaming a scalar--&gt;</span></div>
<div class="line">    <span class="comment">&lt;!-- Also tests relative variable names. The input must be in a directory which is identical</span></div>
<div class="line"><span class="comment">         top the ocation name, &#39;/DOUBLE&#39; in this case --&gt;</span></div>
<div class="line">    &lt;<span class="keywordtype">property</span> <span class="keyword">source</span>=<span class="stringliteral">&quot;DATA_TYPE_CONSTANT&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;RENAMED_CONSTANT&quot;</span>&gt;</div>
<div class="line">      <span class="comment">&lt;!-- test turning off the history (no special default set per location, on by default) --&gt;</span></div>
<div class="line">      &lt;<span class="keywordtype">has_history</span>&gt;<span class="keyword">false</span>&lt;/<span class="keywordtype">has_history</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">property</span>&gt;</div>
<div class="line">    <span class="comment">&lt;!-- Test adding a scalar from another directory than the one imported. --&gt;</span></div>
<div class="line">    &lt;<span class="keywordtype">property</span> <span class="keyword">source</span>=<span class="stringliteral">&quot;/FLOAT/TO_DEVICE_SCALAR&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;I_AM_A_FLOAT_SCALAR&quot;</span>/&gt;</div>
<div class="line">    <span class="comment">&lt;!-- This variable is not renamed and will end with the property name DOUBLE.TEST_TO_DEVICE_SCALAR, hence the DOUBLE will be the location name AND it will appear in the property name --&gt;</span></div>
<div class="line">    &lt;<span class="keywordtype">property</span> <span class="keyword">source</span>=<span class="stringliteral">&quot;/DOUBLE/TO_DEVICE_SCALAR&quot;</span>&gt;</div>
<div class="line">      <span class="comment">&lt;!-- Test turning off the writeable flag --&gt;</span></div>
<div class="line">      &lt;<span class="keywordtype">is_writeable</span>&gt;<span class="keyword">false</span>&lt;/<span class="keywordtype">is_writeable</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">property</span>&gt;</div>
<div class="line">    <span class="comment">&lt;!-- Test importing a directory which has the same name as the location--&gt;</span></div>
<div class="line">    &lt;<span class="keywordtype">import</span>&gt;/<span class="keyword">DOUBLE</span>&lt;/<span class="keywordtype">import</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">location</span>&gt;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">&lt;!-- Test the global import. The location name is the name of the first directory of the input.</span></div>
<div class="line"><span class="comment">       Input variables already mentioned explicitly or already imported will not be added. --&gt;</span></div>
<div class="line">  &lt;<span class="keywordtype">import</span>&gt;/&lt;/<span class="keywordtype">import</span>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;/<span class="keywordtype">device_server</span>&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="special_config"></a>
Special configuration</h2>
<p>There are a number of configuration parameters which can be set on different scopes to control the exact behaviour of the DOOCS properties. All of the following XML tags can appear either directly in the root tag, or in a location tag, or in a property tag (or any tag for a special property, see Secion <a class="el" href="index.html#special_properties">Special DOOCS properties</a>).</p>
<ul>
<li><code>has_history</code>: Can be set to false or true (default) If set to true, the properties will have a history, if the property type supports this.</li>
<li><code>is_writeable</code>: If set to false, the property will be forced to be read-only, even if the process variable is writeable.</li>
<li><code>macro_pulse_number_source</code>: Name of process variable which contains the macro pusle number which should be attached to the properties.</li>
<li><code>data_matching</code>: Possible values are <code>none</code>, <code>exact</code>. This is relevant when macro pulse number source is given. The default is <code>exact</code>, which means the server discards data coming in so late that it's version number is overtaken by that of the macro pulse number.</li>
<li><code>persist</code>: Controls behaviour of DOOCS persistency files. This is only important for writable arrays with more than MAX_CONF_LENGTH entries (usually 20). Possible values are <code>true</code> (the default) - always save the array, where long arrays are saved in separate files below <code>hist/</code> while short arrays go into the server config file; <code>false</code> - do not save the array; <code>auto</code> - default DOOCS behaviour, only arrays with up to 20 entries are saved, in server config file.</li>
</ul>
<h2><a class="anchor" id="zeromq"></a>
ZeroMQ publication</h2>
<p>DOOCS properties can be published via ZeroMQ so that clients can be notified about updates in real time. To enable this one simply has to specifiy the <code>publish_ZMQ</code> tag as shown in the following example:</p>
<div class="fragment"><div class="line">&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">encoding</span>=<span class="stringliteral">&quot;UTF-8&quot;</span>?&gt;</div>
<div class="line">&lt;<span class="keywordtype">device_server</span> <span class="keyword">xmlns</span>=<span class="stringliteral">&quot;https://github.com/ChimeraTK/ControlSystemAdapter-DoocsAdapter&quot;</span>&gt;</div>
<div class="line">  <span class="comment">&lt;!-- It must be irrelevant whether the macro pulse number is processed before or after the variable which is tested by value;</span></div>
<div class="line"><span class="comment">     the test cases cover both cases. --&gt;</span></div>
<div class="line">  &lt;<span class="keywordtype">data_matching</span>&gt;<span class="keyword">exact</span>&lt;/<span class="keywordtype">data_matching</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">macro_pulse_number_source</span>&gt;/<span class="keyword">UINT</span>/<span class="keyword">FROM_DEVICE_SCALAR</span>&lt;/<span class="keywordtype">macro_pulse_number_source</span>&gt;</div>
<div class="line"> </div>
<div class="line">  &lt;<span class="keywordtype">location</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;INT&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">property</span> <span class="keyword">source</span>=<span class="stringliteral">&quot;/INT/FROM_DEVICE_SCALAR&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;FROM_DEVICE_SCALAR&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">publish_ZMQ</span>&gt;<span class="keyword">true</span>&lt;/<span class="keywordtype">publish_ZMQ</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">property</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">property</span> <span class="keyword">source</span>=<span class="stringliteral">&quot;/INT/FROM_DEVICE_ARRAY&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;FROM_DEVICE_ARRAY&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">publish_ZMQ</span>&gt;<span class="keyword">true</span>&lt;/<span class="keywordtype">publish_ZMQ</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">property</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">import</span>&gt;/<span class="keyword">INT</span>&lt;/<span class="keywordtype">import</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">location</span>&gt;</div>
<div class="line"> </div>
<div class="line">  &lt;<span class="keywordtype">location</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;FLOAT&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">D_spectrum</span> <span class="keyword">source</span>=<span class="stringliteral">&quot;/FLOAT/FROM_DEVICE_ARRAY&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;FROM_DEVICE_ARRAY&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">start</span>&gt;123.&lt;/<span class="keywordtype">start</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">increment</span>&gt;0.56&lt;/<span class="keywordtype">increment</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">publish_ZMQ</span>&gt;<span class="keyword">true</span>&lt;/<span class="keywordtype">publish_ZMQ</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">D_spectrum</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">import</span>&gt;/<span class="keyword">FLOAT</span>&lt;/<span class="keywordtype">import</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">location</span>&gt;</div>
<div class="line"> </div>
<div class="line">  &lt;<span class="keywordtype">location</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;UINT&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">property</span> <span class="keyword">source</span>=<span class="stringliteral">&quot;/UINT/TO_DEVICE_SCALAR&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;TO_DEVICE_SCALAR&quot;</span>/&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">location</span>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;/<span class="keywordtype">device_server</span>&gt;</div>
</div><!-- fragment --><p>If the <code>macro_pulse_number_source</code> tag has been used, the macro pulse number will be added to the ZeroMQ header.</p>
<h2><a class="anchor" id="type_override"></a>
Overriding auto-detected types</h2>
<p>If the automatically derived data type of the DOOCS property is not fitting, it is possible to override it using the <code>type</code> attribute on the <code>property</code> and <a class="el" href="index.html#D_array">D_array</a> tags. <code>type</code> can be one of</p>
<ul>
<li>auto (default)</li>
<li>byte</li>
<li>short</li>
<li>int</li>
<li>long</li>
<li>float</li>
<li>double</li>
</ul>
<p>For an example, see above in Section <a class="el" href="index.html#mapping_file">DOOCS adapter mapping file</a>.</p>
<h2><a class="anchor" id="special_properties"></a>
Special DOOCS properties</h2>
<p>Instead of letting the DOOCS adapter automatically decide which DOOCS data type to use, it is possible to specify a particular type. This needs to be done whenever a special DOOCS property type should be used.</p>
<h3><a class="anchor" id="D_spectrum"></a>
D_spectrum</h3>
<p>The <code>D_spectrum</code> tag takes the following arguments through sub-tags:</p><ul>
<li><code>start</code>: The x-axis start as a fixed number</li>
<li><code>increment</code>: The x-axis increment between two samples as a fixed number</li>
<li><code>startSource</code>: Name of process variable which should be used as x-axis start</li>
<li><code>incrementSource</code>: Name of process variable which should be used as x-axis increment</li>
<li><code>numberOfBuffers</code>: Create a buffered D_spectrum with a short-term history (so clients can read consistent data across multiple D_spectrum). Requires a configured macro_pulse_number_source.</li>
</ul>
<p>The <code>D_spectrum</code> tag takes the following arguments through sub-tags:</p><ul>
<li><code>unit</code> : A description of the respective axis. The axis is chosen with the <code>axis</code> property which can either be <code>x</code> or <code>y</code>. It can also contain a "start" and an "end" for the initial display parameters as well as "logarithmic" for switching the scale accordingly. For an example of this see <a class="el" href="index.html#D_xy">D_xy</a></li>
</ul>
<p>For an example, see above in Section <a class="el" href="index.html#mapping_file">DOOCS adapter mapping file</a>.</p>
<h3><a class="anchor" id="D_array"></a>
D_array</h3>
<p>The <code>D_array</code> tag takes the following arguments through XML attributes of the D_array tag:</p><ul>
<li><code>type</code>: Override the data type. Can be one of:<ul>
<li>auto (default)</li>
<li>byte</li>
<li>short</li>
<li>int</li>
<li>long</li>
<li>float</li>
<li>double</li>
</ul>
</li>
</ul>
<p>For an example, see above in Section <a class="el" href="index.html#mapping_file">DOOCS adapter mapping file</a>.</p>
<h3><a class="anchor" id="D_xy"></a>
D_xy</h3>
<p>The <code>D_xy</code> tag takes the following arguments through properties:</p><ul>
<li><code>x_source</code> : Name of process variable which should be used for x-axis values</li>
<li><code>y_source</code> : Name of process variable which should be used for y-axis values</li>
<li><code>name</code> : Name of the mapped property The <code>D_xy</code> tag takes the following arguments through sub-tags:</li>
<li><code>description</code> : A description for the XY plot</li>
<li><code>unit</code> : A description of the respective axis. The axis is chosen with the <code>axis</code> property which can either be <code>x</code> or <code>y</code></li>
</ul>
<div class="fragment"><div class="line">&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">encoding</span>=<span class="stringliteral">&quot;UTF-8&quot;</span>?&gt;</div>
<div class="line">&lt;<span class="keywordtype">device_server</span> <span class="keyword">xmlns</span>=<span class="stringliteral">&quot;https://github.com/ChimeraTK/ControlSystemAdapter-DoocsAdapter&quot;</span>&gt;</div>
<div class="line"> </div>
<div class="line">  &lt;<span class="keywordtype">location</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;FLOAT&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">D_xy</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;TEST_XY&quot;</span></div>
<div class="line">          <span class="keyword">x_source</span>=<span class="stringliteral">&quot;/FLOAT/FROM_DEVICE_ARRAY&quot;</span></div>
<div class="line">          <span class="keyword">y_source</span>=<span class="stringliteral">&quot;/DOUBLE/FROM_DEVICE_ARRAY&quot;</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">description</span>&gt;<span class="keyword">Some</span> <span class="keyword">XY</span> <span class="keyword">test</span>&lt;/<span class="keywordtype">description</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">unit</span> <span class="keyword">axis</span>=<span class="stringliteral">&quot;x&quot;</span>&gt;<span class="keyword">mm</span>&lt;/<span class="keywordtype">unit</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">unit</span> <span class="keyword">axis</span>=<span class="stringliteral">&quot;y&quot;</span>&gt;<span class="keyword">Âµs</span>&lt;/<span class="keywordtype">unit</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">D_xy</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">import</span>&gt;/<span class="keyword">FLOAT</span>&lt;/<span class="keywordtype">import</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">location</span>&gt;</div>
<div class="line"> </div>
<div class="line">  &lt;<span class="keywordtype">location</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DOUBLE&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">import</span>&gt;/<span class="keyword">DOUBLE</span>&lt;/<span class="keywordtype">import</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">location</span>&gt;</div>
<div class="line"> </div>
<div class="line">  &lt;<span class="keywordtype">location</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;INT&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">property</span> <span class="keyword">source</span>=<span class="stringliteral">&quot;/INT/TO_DEVICE_SCALAR&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;TO_DEVICE_SCALAR&quot;</span>/&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">location</span>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;/<span class="keywordtype">device_server</span>&gt;</div>
</div><!-- fragment --><h3><a class="anchor" id="D_ifff"></a>
D_ifff</h3>
<p>The <code>D_ifff</code> tag takes the following arguments through attributes:</p><ul>
<li><code>i1_source</code> : Name of process variable which should be used for first integer values</li>
<li><code>f1_source</code>, <code>f2_source</code>, <code>f3_source</code> : Name of process variables which should be used for float values</li>
<li><code>name</code> : Name of the mapped property The four mapped variables must provide data-consistent updates, unless <code>data_matching="none"</code> is specified.</li>
</ul>
<div class="fragment"><div class="line">&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">encoding</span>=<span class="stringliteral">&quot;UTF-8&quot;</span>?&gt;</div>
<div class="line">&lt;<span class="keywordtype">device_server</span> <span class="keyword">xmlns</span>=<span class="stringliteral">&quot;https://github.com/ChimeraTK/ControlSystemAdapter-DoocsAdapter&quot;</span>&gt;</div>
<div class="line"> </div>
<div class="line">  &lt;<span class="keywordtype">location</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;CUSTOM&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">D_ifff</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;IFFF&quot;</span></div>
<div class="line">          <span class="keyword">i1_source</span>=<span class="stringliteral">&quot;/INT/FROM_DEVICE_SCALAR&quot;</span></div>
<div class="line">          <span class="keyword">f1_source</span>=<span class="stringliteral">&quot;/FLOAT/FROM_DEVICE_SCALAR&quot;</span></div>
<div class="line">          <span class="keyword">f2_source</span>=<span class="stringliteral">&quot;/DOUBLE/FROM_DEVICE_SCALAR&quot;</span></div>
<div class="line">          <span class="keyword">f3_source</span>=<span class="stringliteral">&quot;/SHORT/FROM_DEVICE_SCALAR&quot;</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">D_ifff</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">location</span>&gt;</div>
<div class="line"> </div>
<div class="line">  &lt;<span class="keywordtype">import</span>&gt;/&lt;/<span class="keywordtype">import</span>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;/<span class="keywordtype">device_server</span>&gt;</div>
</div><!-- fragment --><h3><a class="anchor" id="D_imagec"></a>
D_imagec</h3>
<p>The <code>D_imagec</code> (c for compact image) tag takes the following arguments through attributes:</p><ul>
<li><code>source</code> : Name of process variable which contains the data as array of unsigned char. Data consists of an image header defined as ChimeraTK::ImgHeader followed by the encoded pixel values.</li>
<li><code>description</code>: Used as comment for the image, in the meta data.</li>
</ul>
<p>If <code>data_matching="exact"</code> is set, the provided macropulse number is set as event id in the meta data.</p>
<h2><a class="anchor" id="set_error"></a>
Error reporting</h2>
<p>The special tag <code>set_error</code> is allowed only once per location. XML attributes:</p><ul>
<li><code>statusCodeSource</code> : Path to the process variable which should be used for reading error/status codes.</li>
</ul>
<p>DoocsAdapter will automatically look for an associated variable with error/status messages, and if present, read both consistently. Errors indicated via the status variable will be published via DOOCS set_error function (of the location), which sets the properties ERROR, ERROR.STR, STS.ERROR, STS.NEWERROR, and also logs into LOG, LOG.LAST, LOG_HTML and LOG_HTML.LAST. Compare DOOCS documentation for error properties and propagation to the overall error counting per server, SVR.ERROR_COUNT.</p>
<h2><a class="anchor" id="specifie_code"></a>
Specify &lt;tt&gt;eq_fct_code&lt;/tt&gt; in the mapping file</h2>
<p>It is possible to specify the <code>eq_fct_code</code> which must match <code>eq_fct_type</code> in the configuration file with <code>code</code> in the &lt;location&gt; tag of the mapping file.</p>
<p>If <code>eq_fct_type</code> is set in the configuration file, <code>code</code> must have the same number in the mapping file. If the location in the configuration file is missing, you can set your own new <code>code</code> in the mapping file. But if no code is set, the default code is 10. You can set <code>code</code> multiple times, but <code>code</code> must always be consistent. The <code>code</code> must be integer and &gt; 1, since 1 is reserved for server. <br  />
</p>
<p>An example configuration file and mapping file with the code specified:</p>
<div class="fragment"></div><!-- fragment --><div class="fragment"></div><!-- fragment --><p>The location <code>DOUBLE</code> has already the <code>code</code> 10 specified in the configuration file. If you set the <code>code</code> in the mapping file, it must have 10 as well.</p>
<p>The location <code>CREATED</code> will be created new with the default <code>code</code> of 10.</p>
<p>The location <code>NEW</code> will be created new with <code>code</code> of 12.</p>
<p>The location <code>FLOAT</code> is only specifed in the configuration file but will be also created with <code>code</code> 11. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Aug 20 2024 11:49:27 for ChimeraTK-ControlSystemAdapter-DoocsAdapter by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
