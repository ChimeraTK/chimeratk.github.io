<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ChimeraTK-DeviceAccess: Logical Name Mapping Backend</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ChimeraTK_Logo_whitebg.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ChimeraTK-DeviceAccess
   &#160;<span id="projectnumber">master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lmap.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Logical Name Mapping Backend </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Backend to map logical register names onto real hardware registers.</p>
<p>It reads the logical name map from an xml file and will open internally additional Devices as they are reference in that file.</p>
<p>This page is still incomplete and will be extended in future.</p>
<h1><a class="anchor" id="cdd"></a>
CDD syntax</h1>
<p>The map file should be specified by the "map" parameter in the CDD, i.e.: <code>(logicalNameMap?map=path/to/mapfile.xlmap)</code></p>
<p>Additional parameters can be passed through the CDD, which are available inside the xlmap file via <code>&lt;par&gt;&lt;/par&gt;</code> tags, e.g. when using the CDD <code>(logicalNameMap?map=path/to/mapfile.xlmap&amp;myParam=HelloWorld)</code> the tag <code>&lt;par&gt;myParam&lt;/par&gt;</code> inside the xlmap file would be replaced with <code>HelloWorld</code>.</p>
<h1><a class="anchor" id="map"></a>
Map file syntax</h1>
<p>This section is incomplete.</p>
<p>Example with most features: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">logicalNameMap</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">redirectedRegister</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SingleWord&quot;</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">targetDevice</span>&gt;<span class="keyword">PCIE2</span>&lt;/<span class="keywordtype">targetDevice</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">targetRegister</span>&gt;<span class="keyword">BOARD.WORD_USER</span>&lt;/<span class="keywordtype">targetRegister</span>&gt;</div><div class="line">    &lt;/<span class="keywordtype">redirectedRegister</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">redirectedRegister</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;FullArea&quot;</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">targetDevice</span>&gt;<span class="keyword">PCIE2</span>&lt;/<span class="keywordtype">targetDevice</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">targetRegister</span>&gt;<span class="keyword">ADC.AREA_DMAABLE</span>&lt;/<span class="keywordtype">targetRegister</span>&gt;</div><div class="line">    &lt;/<span class="keywordtype">redirectedRegister</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">redirectedRegister</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;PartOfArea&quot;</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">targetDevice</span>&gt;<span class="keyword">PCIE2</span>&lt;/<span class="keywordtype">targetDevice</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">targetRegister</span>&gt;<span class="keyword">ADC.AREA_DMAABLE</span>&lt;/<span class="keywordtype">targetRegister</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">targetStartIndex</span>&gt;10&lt;/<span class="keywordtype">targetStartIndex</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">numberOfElements</span>&gt;20&lt;/<span class="keywordtype">numberOfElements</span>&gt;</div><div class="line">    &lt;/<span class="keywordtype">redirectedRegister</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">redirectedChannel</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Channel3&quot;</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">targetDevice</span>&gt;<span class="keyword">PCIE3</span>&lt;/<span class="keywordtype">targetDevice</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">targetRegister</span>&gt;<span class="keyword">TEST.NODMA</span>&lt;/<span class="keywordtype">targetRegister</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">targetChannel</span>&gt;3&lt;/<span class="keywordtype">targetChannel</span>&gt;</div><div class="line">    &lt;/<span class="keywordtype">redirectedChannel</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">constant</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Constant&quot;</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">type</span>&gt;<span class="keyword">integer</span>&lt;/<span class="keywordtype">type</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">value</span>&gt;42&lt;/<span class="keywordtype">value</span>&gt;</div><div class="line">    &lt;/<span class="keywordtype">constant</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">redirectedRegister</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SingleWord_Scaled&quot;</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">targetDevice</span>&gt;<span class="keyword">PCIE2</span>&lt;/<span class="keywordtype">targetDevice</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">targetRegister</span>&gt;<span class="keyword">BOARD.WORD_USER</span>&lt;/<span class="keywordtype">targetRegister</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">plugin</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;multiply&quot;</span>&gt;</div><div class="line">          &lt;<span class="keywordtype">parameter</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;factor&quot;</span>&gt;4.2&lt;/<span class="keywordtype">parameter</span>&gt;</div><div class="line">        &lt;/<span class="keywordtype">plugin</span>&gt;</div><div class="line">    &lt;/<span class="keywordtype">redirectedRegister</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">module</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MyModule&quot;</span>&gt;</div><div class="line">      &lt;<span class="keywordtype">module</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SomeSubmodule&quot;</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">variable</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Variable&quot;</span>&gt;</div><div class="line">          &lt;<span class="keywordtype">type</span>&gt;<span class="keyword">integer</span>&lt;/<span class="keywordtype">type</span>&gt;</div><div class="line">          &lt;<span class="keywordtype">value</span>&gt;2&lt;/<span class="keywordtype">value</span>&gt;</div><div class="line">        &lt;/<span class="keywordtype">variable</span>&gt;</div><div class="line">      &lt;/<span class="keywordtype">module</span>&gt;</div><div class="line">      &lt;<span class="keywordtype">redirectedChannel</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;ConfigurableChannel&quot;</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">targetDevice</span>&gt;<span class="keyword">PCIE3</span>&lt;/<span class="keywordtype">targetDevice</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">targetRegister</span>&gt;<span class="keyword">TEST.NODMA</span>&lt;/<span class="keywordtype">targetRegister</span>&gt;</div><div class="line">        &lt;<span class="keywordtype">targetChannel</span>&gt;&lt;<span class="keywordtype">ref</span>&gt;/<span class="keyword">Constant</span>&lt;/<span class="keywordtype">ref</span>&gt;&lt;/<span class="keywordtype">targetChannel</span>&gt;</div><div class="line">      &lt;/<span class="keywordtype">redirectedChannel</span>&gt;</div><div class="line">    &lt;/<span class="keywordtype">module</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">redirectedBit</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Bit0ofVar&quot;</span>&gt;</div><div class="line">      &lt;<span class="keywordtype">targetDevice</span>&gt;<span class="keyword">this</span>&lt;/<span class="keywordtype">targetDevice</span>&gt;</div><div class="line">      &lt;<span class="keywordtype">targetRegister</span>&gt;/<span class="keyword">MyModule</span>/<span class="keyword">SomeSubmodule</span>/<span class="keyword">Variable</span>&lt;/<span class="keywordtype">targetRegister</span>&gt;</div><div class="line">      &lt;<span class="keywordtype">targetBit</span>&gt;0&lt;/<span class="keywordtype">targetBit</span>&gt;</div><div class="line">    &lt;/<span class="keywordtype">redirectedBit</span>&gt;</div><div class="line">&lt;/<span class="keywordtype">logicalNameMap</span>&gt;</div></div><!-- fragment --><h2><a class="anchor" id="internal_redirect"></a>
Self-referencing redirects</h2>
<p>It is possible to redirect registers to other registers in the same xlmap file using the special device <code>this</code>: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">redirectedBit</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Bit0ofVar&quot;</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">targetDevice</span>&gt;<span class="keyword">this</span>&lt;/<span class="keywordtype">targetDevice</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">targetRegister</span>&gt;/<span class="keyword">MyModule</span>/<span class="keyword">SomeSubmodule</span>/<span class="keyword">Variable</span>&lt;/<span class="keywordtype">targetRegister</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">targetBit</span>&gt;0&lt;/<span class="keywordtype">targetBit</span>&gt;</div><div class="line">&lt;/<span class="keywordtype">redirectedBit</span>&gt;</div></div><!-- fragment --><h1><a class="anchor" id="plugins"></a>
Accessor plugins</h1>
<p>Special features like mathematical conversions can be enabled on a per-register basis by using accessor plugins. Any number of plugins can be enabled for each register. Each plugin takes a list of parameters, which depend on the type of the plugin.</p>
<p>In the xlmap file, plugins can be specified by adding one ore more <code>&lt;plugin&gt;</code> tags, e.g.: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">redirectedRegister</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SingleWord_Scaled_Twice&quot;</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">targetDevice</span>&gt;<span class="keyword">PCIE2</span>&lt;/<span class="keywordtype">targetDevice</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">targetRegister</span>&gt;<span class="keyword">BOARD.WORD_USER</span>&lt;/<span class="keywordtype">targetRegister</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">plugin</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;multiply&quot;</span>&gt;</div><div class="line">      &lt;<span class="keywordtype">parameter</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;factor&quot;</span>&gt;2&lt;/<span class="keywordtype">parameter</span>&gt;</div><div class="line">    &lt;/<span class="keywordtype">plugin</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">plugin</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;multiply&quot;</span>&gt;</div><div class="line">      &lt;<span class="keywordtype">parameter</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;factor&quot;</span>&gt;3&lt;/<span class="keywordtype">parameter</span>&gt;</div><div class="line">    &lt;/<span class="keywordtype">plugin</span>&gt;</div><div class="line">&lt;/<span class="keywordtype">redirectedRegister</span>&gt;</div></div><!-- fragment --><p> This will enable two instances of the <code>multiply</code> plugin.</p>
<h2><a class="anchor" id="plugins_reference"></a>
List of plugins</h2>
<p>The following plugins can be enabled. It is not possible to extend the Logical Name Mapping Backend with plugins through runtime loading or linking, all plugins have to be shipped with the DeviceAccess library.</p>
<h3><a class="anchor" id="plugins_reference_multiply"></a>
multiply</h3>
<p>The <code>multiply</code> plugin multiplies the value of the register with the given factor. Note that the multiplication is done for both reading and writing. Hence if this plugin is used e.g. to convert a raw value into a physical value, the register should be used in one direction only. The plugin will internally always read the value as a 64 bit floating point, so the result may not be bit exact. The target register must be numeric.</p>
<p>Parameters:</p><ul>
<li><code>factor</code>: Factor to multiply the value with. Will be interpreted as a (floating-point) number.</li>
</ul>
<h3><a class="anchor" id="plugins_reference_math"></a>
math</h3>
<p>The <code>math</code> plugin allows to apply an arbitrary mathematical formula to the data. The exprtk library is used to parse the library. For an exact documentation of the possible syntax, please refer to its documentation: <a href="http://www.partow.net/programming/exprtk/index.html">http://www.partow.net/programming/exprtk/index.html</a></p>
<p>Similar to the <code>multiply</code> plugin, the same formula is applied for both reading and writing, which usually makes only sense if the register is used in a single direction. The shape of the register cannot be changed, i.e. the number of elements returned by the formula must be equal to the number of elements of the target register.</p>
<p>Parameters:</p><ul>
<li><code>formula</code>: The formula to apply to the data. Within the formula, the parameter <code>x</code> can be used to reference the current register value.</li>
<li>Any additional parameter value will be interpreted as a register name of the logical name mapper device. The register value will be made available to the formula by the name of the parameter. Everytime the formula is evaluated, the registers will be read, so the current values are provided.</li>
</ul>
<p>Examples for formulae:</p><ul>
<li><p class="startli"><code>x/7 + 13</code></p>
<p class="startli">This will only work for scalar registers</p>
</li>
<li><p class="startli"><code>return [ x/7 + 13 ];</code></p>
<p class="startli">Can be used for both scalars and arrays. In case of an array, the formula will be applied to each element of the array, since exprtk supports processing of arrays (or vectors as they call it in their documentation).</p>
</li>
<li><p class="startli">Full example with parameters: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">plugin</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;math&quot;</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">parameter</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;formula&quot;</span>&gt;<span class="keyword">x</span>*<span class="keyword">factor</span> + <span class="keyword">offset</span>&lt;/<span class="keywordtype">parameter</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">parameter</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;factor&quot;</span>&gt;/<span class="keyword">Calibration</span>/<span class="keyword">factor</span>&lt;/<span class="keywordtype">parameter</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">parameter</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;offset&quot;</span>&gt;/<span class="keyword">Calibration</span>/<span class="keyword">offset</span>&lt;/<span class="keywordtype">parameter</span>&gt;</div><div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div></div><!-- fragment --><p> The registers <code>/Calibration/factor</code> and <code>/Calibration/offset</code> need to be specified in the same xlmap file. They wil be read each time the formula is evaluated (because the plugin register is read or written). Parameter registers can be scalar or 1D arrays.</p>
<p class="startli">Hint: If the parameter register is a variable, it can be written by the application. This allows e.g. the use of calibration value otherwise not known to the device.</p>
</li>
</ul>
<h3><a class="anchor" id="plugins_reference_force_read_only"></a>
forceReadOnly</h3>
<p>The <code>forceReadOnly</code> plugin changes the access mode of a register to read-only. The target register has to be writeable. This plugin accepts no parameters.</p>
<h3><a class="anchor" id="plugins_reference_monostable_trigger"></a>
monostableTrigger</h3>
<p>The <code>monostableTrigger</code> implements a monostable behaviour triggered by a write transaction. The target register has to be an integral scalar and has to be writeable. The resulting logical register will be write only with the type RegisterInfo::FundamentalType::nodata, i.e. the data written to the register will be discarded. Instead, the "active" value will be written, and after a delay the "inactive" value.</p>
<p>Parameters:</p><ul>
<li><code>milliseconds</code>: Delay in milliseconds.</li>
<li><code>active</code>: The active value to be written before the delay, as unsigned 32 bit integer. Optional, defaults to 1</li>
<li><code>inactive</code>: The inactive value to be written after the delay, as unsigned 32 bit integer. Optional, defaults to 0</li>
</ul>
<p>Note that writing to the logical register will block for the full duration of the two target write transfers including the delay. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Apr 19 2019 03:53:07 for ChimeraTK-DeviceAccess by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
