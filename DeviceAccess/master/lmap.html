<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ChimeraTK-DeviceAccess: Logical Name Mapping Backend</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ChimeraTK_Logo_whitebg.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ChimeraTK-DeviceAccess
   &#160;<span id="projectnumber">master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('lmap.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Logical Name Mapping Backend </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Backend to map logical register names onto real hardware registers.</p>
<p>It reads the logical name map from an xml file and will open internally additional Devices as they are reference in that file.</p>
<p>This page is still incomplete and will be extended in future.</p>
<h1><a class="anchor" id="cdd"></a>
CDD syntax</h1>
<p>The map file should be specified by the "map" parameter in the CDD, i.e.: <code>(logicalNameMap?map=path/to/mapfile.xlmap)</code></p>
<p>Additional parameters can be passed through the CDD, which are available inside the xlmap file via <code>&lt;par&gt;&lt;/par&gt;</code> tags, e.g. when using the CDD <code>(logicalNameMap?map=path/to/mapfile.xlmap&amp;myParam=HelloWorld)</code> the tag <code>&lt;par&gt;myParam&lt;/par&gt;</code> inside the xlmap file would be replaced with <code>HelloWorld</code>.</p>
<h1><a class="anchor" id="map"></a>
Map file syntax</h1>
<p>This section is incomplete.</p>
<p>Example with most features: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">logicalNameMap</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">redirectedRegister</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SingleWord&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">targetDevice</span>&gt;<span class="keyword">PCIE2</span>&lt;/<span class="keywordtype">targetDevice</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">targetRegister</span>&gt;<span class="keyword">BOARD.WORD_USER</span>&lt;/<span class="keywordtype">targetRegister</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">redirectedRegister</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">redirectedRegister</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;FullArea&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">targetDevice</span>&gt;<span class="keyword">PCIE2</span>&lt;/<span class="keywordtype">targetDevice</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">targetRegister</span>&gt;<span class="keyword">ADC.AREA_DMAABLE</span>&lt;/<span class="keywordtype">targetRegister</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">redirectedRegister</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">redirectedRegister</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;PartOfArea&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">targetDevice</span>&gt;<span class="keyword">PCIE2</span>&lt;/<span class="keywordtype">targetDevice</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">targetRegister</span>&gt;<span class="keyword">ADC.AREA_DMAABLE</span>&lt;/<span class="keywordtype">targetRegister</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">targetStartIndex</span>&gt;10&lt;/<span class="keywordtype">targetStartIndex</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">numberOfElements</span>&gt;20&lt;/<span class="keywordtype">numberOfElements</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">redirectedRegister</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">redirectedChannel</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Channel3&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">targetDevice</span>&gt;<span class="keyword">PCIE3</span>&lt;/<span class="keywordtype">targetDevice</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">targetRegister</span>&gt;<span class="keyword">TEST.NODMA</span>&lt;/<span class="keywordtype">targetRegister</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">targetChannel</span>&gt;3&lt;/<span class="keywordtype">targetChannel</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">redirectedChannel</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">constant</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Constant&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">type</span>&gt;<span class="keyword">integer</span>&lt;/<span class="keywordtype">type</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">value</span>&gt;42&lt;/<span class="keywordtype">value</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">constant</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">redirectedRegister</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SingleWord_Scaled&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">targetDevice</span>&gt;<span class="keyword">PCIE2</span>&lt;/<span class="keywordtype">targetDevice</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">targetRegister</span>&gt;<span class="keyword">BOARD.WORD_USER</span>&lt;/<span class="keywordtype">targetRegister</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">plugin</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;multiply&quot;</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">parameter</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;factor&quot;</span>&gt;4.2&lt;/<span class="keywordtype">parameter</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">plugin</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">redirectedRegister</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">module</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;MyModule&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">module</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SomeSubmodule&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">variable</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Variable&quot;</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">type</span>&gt;<span class="keyword">integer</span>&lt;/<span class="keywordtype">type</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">value</span>&gt;2&lt;/<span class="keywordtype">value</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">variable</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">module</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">redirectedChannel</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;ConfigurableChannel&quot;</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">targetDevice</span>&gt;<span class="keyword">PCIE3</span>&lt;/<span class="keywordtype">targetDevice</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">targetRegister</span>&gt;<span class="keyword">TEST.NODMA</span>&lt;/<span class="keywordtype">targetRegister</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">targetChannel</span>&gt;&lt;<span class="keywordtype">ref</span>&gt;/<span class="keyword">Constant</span>&lt;/<span class="keywordtype">ref</span>&gt;&lt;/<span class="keywordtype">targetChannel</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">redirectedChannel</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">module</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">redirectedBit</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Bit0ofVar&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">targetDevice</span>&gt;<span class="keyword">this</span>&lt;/<span class="keywordtype">targetDevice</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">targetRegister</span>&gt;/<span class="keyword">MyModule</span>/<span class="keyword">SomeSubmodule</span>/<span class="keyword">Variable</span>&lt;/<span class="keywordtype">targetRegister</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">targetBit</span>&gt;0&lt;/<span class="keywordtype">targetBit</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">redirectedBit</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">logicalNameMap</span>&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="variables_and_constants"></a>
Variables and constants</h2>
<p>It is possible to define variables and constants that do not exist in the target device. They can be used to parameterize other registers or plugins. </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">variable</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Variable&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">type</span>&gt;<span class="keyword">integer</span>&lt;/<span class="keywordtype">type</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">value</span>&gt;2&lt;/<span class="keywordtype">value</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">variable</span>&gt;</div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">constant</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Constant&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">type</span>&gt;<span class="keyword">integer</span>&lt;/<span class="keywordtype">type</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">value</span>&gt;42&lt;/<span class="keywordtype">value</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">constant</span>&gt;</div>
</div><!-- fragment --><p> The types available are defined by the <a class="el" href="class_chimera_t_k_1_1_data_type.html" title="A class to describe which of the supported data types is used.">ChimeraTK::DataType</a> class: <code>int8, uint8, int16, uint16, int32, uint32, int64, uint64, float32, float64, string</code>. In addition, <code>integer</code> can be used as an alias for <code>int32</code>.</p>
<h2><a class="anchor" id="internal_redirect"></a>
Self-referencing redirects</h2>
<p>It is possible to redirect registers to other registers in the same xlmap file using the special device <code>this</code>: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">redirectedBit</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Bit0ofVar&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">targetDevice</span>&gt;<span class="keyword">this</span>&lt;/<span class="keywordtype">targetDevice</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">targetRegister</span>&gt;/<span class="keyword">MyModule</span>/<span class="keyword">SomeSubmodule</span>/<span class="keyword">Variable</span>&lt;/<span class="keywordtype">targetRegister</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">targetBit</span>&gt;0&lt;/<span class="keywordtype">targetBit</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">redirectedBit</span>&gt;</div>
</div><!-- fragment --><h1><a class="anchor" id="plugins"></a>
Accessor plugins</h1>
<p>Special features like mathematical conversions can be enabled on a per-register basis by using accessor plugins. Any number of plugins can be enabled for each register. Each plugin takes a list of parameters, which depend on the type of the plugin.</p>
<p>In the xlmap file, plugins can be specified by adding one ore more <code>&lt;plugin&gt;</code> tags, e.g.: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">redirectedRegister</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SingleWord_Scaled_Twice&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">targetDevice</span>&gt;<span class="keyword">PCIE2</span>&lt;/<span class="keywordtype">targetDevice</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">targetRegister</span>&gt;<span class="keyword">BOARD.WORD_USER</span>&lt;/<span class="keywordtype">targetRegister</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">plugin</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;multiply&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">parameter</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;factor&quot;</span>&gt;2&lt;/<span class="keywordtype">parameter</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">plugin</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">plugin</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;multiply&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">parameter</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;factor&quot;</span>&gt;3&lt;/<span class="keywordtype">parameter</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">plugin</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">redirectedRegister</span>&gt;</div>
</div><!-- fragment --><p> This will enable two instances of the <code>multiply</code> plugin.</p>
<h2><a class="anchor" id="plugins_reference"></a>
List of plugins</h2>
<p>The following plugins can be enabled. It is not possible to extend the Logical Name Mapping Backend with plugins through runtime loading or linking, all plugins have to be shipped with the DeviceAccess library.</p>
<h3><a class="anchor" id="plugins_reference_multiply"></a>
multiply</h3>
<p>The <code>multiply</code> plugin multiplies the value of the register with the given factor. Note that the multiplication is done for both reading and writing. Hence if this plugin is used e.g. to convert a raw value into a physical value, the register should be used in one direction only. The plugin will internally always read the value as a 64 bit floating point, so the result may not be bit exact. The target register must be numeric.</p>
<p>Parameters:</p><ul>
<li><code>factor</code>: Factor to multiply the value with. Will be interpreted as a (floating-point) number.</li>
</ul>
<h3><a class="anchor" id="plugins_reference_math"></a>
math</h3>
<p>The <code>math</code> plugin allows to apply an arbitrary mathematical formula to the data. The exprtk library is used to parse the library. For an exact documentation of the possible syntax, please refer to its documentation: <a href="http://www.partow.net/programming/exprtk/index.html">http://www.partow.net/programming/exprtk/index.html</a></p>
<p>The math plugin enforces the register to be used in a single direction (read or write). If the target register is writable, the logical register will be write-only, otherwise read-only. In case a writeable regiser shall be read through the math plugin, the <a class="el" href="lmap.html#plugins_reference_force_read_only">forceReadOnly</a> plugin shall be specified before the math plugin.</p>
<p>The shape of the register cannot be changed, i.e. the number of elements returned by the formula must be equal to the number of elements of the target register. All calculations will be done internally as double-precision floating point.</p>
<p>Parameters:</p><ul>
<li><code>formula</code>: The formula to apply to the data. Within the formula, the parameter <code>x</code> can be used to reference the current register value.</li>
<li><code>enable_push_parameters</code>: This parameter takes no value. If the parameter is present, the target register is writeable and there is at least one parameter which supports AccessMode::wait_for_new_data, a thread will be launched when opening the device. This thread will wait for any of the push-type parameters to change. If a change is received, all poll-type parameters are polled, the result of the formula is computed (based on the last data written to the logical register) and the target register is written.</li>
<li>Any additional parameter value will be interpreted as a register name of the logical name mapper device. The register value will be made available to the formula by the name of the parameter. Everytime the formula is evaluated, the registers will be read, so the current values are provided.</li>
</ul>
<p>Examples for formulae:</p><ul>
<li><p class="startli"><code>x/7 + 13</code></p>
<p class="startli">This will only work for scalar registers</p>
</li>
<li><p class="startli"><code>return [ x/7 + 13 ];</code></p>
<p class="startli">Can be used for both scalars and arrays. In case of an array, the formula will be applied to each element of the array, since exprtk supports processing of arrays (or vectors as they call it in their documentation).</p>
</li>
<li><p class="startli">Full example with parameters: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">plugin</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;math&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">parameter</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;formula&quot;</span>&gt;<span class="keyword">x</span>*<span class="keyword">factor</span> + <span class="keyword">offset</span>&lt;/<span class="keywordtype">parameter</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">parameter</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;factor&quot;</span>&gt;/<span class="keyword">Calibration</span>/<span class="keyword">factor</span>&lt;/<span class="keywordtype">parameter</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">parameter</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;offset&quot;</span>&gt;/<span class="keyword">Calibration</span>/<span class="keyword">offset</span>&lt;/<span class="keywordtype">parameter</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">plugin</span>&gt;</div>
</div><!-- fragment --><p> The registers <code>/Calibration/factor</code> and <code>/Calibration/offset</code> need to be specified in the same xlmap file. They wil be read each time the formula is evaluated (because the plugin register is read or written). Parameter registers can be scalar or 1D arrays.</p>
<p class="startli">Hint: If the parameter register is a variable, it can be written by the application. This allows e.g. the use of calibration value otherwise not known to the device. Variables support AccessMode::wait_for_new_data, hence in combination with the <code>enable_push_parameters</code> parameter, writing to variables can trigger a write to the target register.</p>
</li>
</ul>
<h3><a class="anchor" id="plugins_reference_force_read_only"></a>
forceReadOnly</h3>
<p>The <code>forceReadOnly</code> plugin changes the access mode of a register to read-only. The target register has to be writeable. This plugin accepts no parameters.</p>
<h2><a class="anchor" id="plugins_reference_force_polling_read"></a>
forcePollingRead</h2>
<p>The <code>forcePollingRead</code> plugin changes the access mode of a register from push-type to poll-type. The plugin accepts no parameters. Will do nothing if the register is poll-type allready.</p>
<h3><a class="anchor" id="plugins_reference_monostable_trigger"></a>
monostableTrigger</h3>
<p>The <code>monostableTrigger</code> implements a monostable behaviour triggered by a write transaction. The target register has to be an integral scalar and has to be writeable. The resulting logical register will be write only with the type RegisterInfo::FundamentalType::nodata, i.e. the data written to the register will be discarded. Instead, the "active" value will be written, and after a delay the "inactive" value.</p>
<p>Parameters:</p><ul>
<li><code>milliseconds</code>: Delay in milliseconds.</li>
<li><code>active</code>: The active value to be written before the delay, as unsigned 32 bit integer. Optional, defaults to 1</li>
<li><code>inactive</code>: The inactive value to be written after the delay, as unsigned 32 bit integer. Optional, defaults to 0</li>
</ul>
<p>Note that writing to the logical register will block for the full duration of the two target write transfers including the delay.</p>
<h3><a class="anchor" id="plugins_reference_type_hint_modifier"></a>
typeHintModifier</h3>
<p>The <code>typeHintModifier</code> is a simple plugin to change the type of the mapped variable in logical name mapper's catalogue. It does, however, <b>NOT</b> perform any type conversion on its own.</p>
<p>Parameters:</p><ul>
<li><code>type</code>: New type. The same type names as for <a class="el" href="lmap.html#variables_and_constants">Variables and constants</a> are supported.</li>
</ul>
<h3><a class="anchor" id="double_buffering_plugin"></a>
Double Buffering plugin for the Logical Name Mapper</h3>
<p>This plugin provides a way to read values form the double buffering scheme provided by the firmware. The double buffering mechanism is abstracted away behind a read only register. The plugin is enabled from the LogicalNameMapping xlmap file:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">redirectedRegister</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;bufferedValue&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">targetDevice</span>&gt;(<span class="keyword">dummy</span>?<span class="keyword">map</span>=<span class="keyword">DoubleBuffer.map</span>)&lt;/<span class="keywordtype">targetDevice</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">targetRegister</span>&gt;<span class="keyword">APP.0.DAQ0_BUF0</span>&lt;/<span class="keywordtype">targetRegister</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">plugin</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;doubleBuffer&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">parameter</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;secondBuffer&quot;</span>&gt; <span class="keyword">APP.0.DAQ0_BUF1</span> &lt;/<span class="keywordtype">parameter</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">parameter</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;controlRegister&quot;</span>&gt; <span class="keyword">ADC.1.WORD_DUB_BUF_ENA</span> &lt;/<span class="keywordtype">parameter</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">parameter</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;statusRegister&quot;</span>&gt; <span class="keyword">ADC.1.WORD_DUB_BUF_CURR</span> &lt;/<span class="keywordtype">parameter</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">parameter</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;daqNumber&quot;</span>&gt;0&lt;/<span class="keywordtype">parameter</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">plugin</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">redirectedRegister</span>&gt;</div>
</div><!-- fragment --><p>This example creates the read only register, <code>bufferedValue</code>. Reading this register returns the value from the current active buffer, hiding away the buffer switching and handshaking tasks under the hood.</p>
<p>The controlRegister and statusRegister hook into the corresponding firmware double buffering interface. The optional parameter <code>daqNumber</code> defines the offset used in the controlRegister and statusRegister. If not present, the value 0 is assumed.</p>
<p>Notes and CAVEATS:</p><ul>
<li>doubleBuffer plugin is not supported for <em>redirectedChannel</em>. The reason we decided against it is that is would be difficult to optimize access to more than one channel. Instead, apply the plugin to the whole 2D area with redirectedRegister, and refer to the logical register in redirectedChannel by targetDevice=this.</li>
<li>Current implementation is safe for concurrent readers from the same process, i.e. the double buffering handshake with the firmware begins when first reader starts reading and ends when last reader of the same double buffered region finishes. Regions are identified on the basis of the controlRegister. However, current implementation is not safe for concurrent readers from different processes. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu May 11 2023 03:53:21 for ChimeraTK-DeviceAccess by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
