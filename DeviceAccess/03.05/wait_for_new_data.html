<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ChimeraTK-DeviceAccess: Using push-type inputs with AccessMode::wait_for_new_data</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ChimeraTK_Logo_whitebg.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ChimeraTK-DeviceAccess
   &#160;<span id="projectnumber">03.05.00</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('wait_for_new_data.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Using push-type inputs with AccessMode::wait_for_new_data </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Usually the content of device registers are read out synchronously: Whe read() is called in an accessor the hardware is accessed.</p>
<p>We call this "poll type" mode. The data transfer is initiated by the application code. The read() operation return immediately after the data transfer, which was initiated by the read operation itself, has finished (non-blocking).</p>
<p>Some accessors provide the possibity to have "push type" operation. In this case the data transfer is initialised by the device. Typical scenarios are interrupts or publish-subcribe patterns where new data is send to the subscriber as soon as it is available. In this case the code does not know when the read() operation will return. It is waiting for new data to arrive (blocking).</p>
<p>To activate the push-type behaviour, the flag AccessMode::wait_for_new_data is used when requesting the accessor. You can check in the catalogue whether the particular accors supports AccessMode::wait_for_new_data. If you reqest this mode but the accessor does not support it, a <a class="el" href="class_chimera_t_k_1_1logic__error.html" title="Exception thrown when a logic error has occured. ">ChimeraTK::logic_error</a> is thrown.</p>
<div class="fragment"><div class="line"><span class="comment">// SPDX-FileCopyrightText: Deutsches Elektronen-Synchrotron DESY, MSK, ChimeraTK Project &lt;chimeratk-support@desy.de&gt;</span></div><div class="line"><span class="comment">// SPDX-License-Identifier: LGPL-3.0-or-later</span></div><div class="line"></div><div class="line"><span class="comment">/*  Unfortunately the DeviceAccess base package does not have a demo push type accessor we can use.</span></div><div class="line"><span class="comment"> *  That&#39;s why this code uses the Doocs backend. Use it together with example2 from ApplicationCore.</span></div><div class="line"><span class="comment"> *  You have to activate the zmq sending in the ApplicationCore example2 by using the configuration files</span></div><div class="line"><span class="comment"> *  demoApp2-DoocsVariableConfig.xml and demo_example2.conf, which are provided with this example.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *  Compile this file by linking directly with the Doocs backend (for instance directly on the command line):</span></div><div class="line"><span class="comment"> *  g++ read_temperature_doocs_zmq.cpp -o read_temperature_doocs_zmq `ChimeraTK-DeviceAccess-config --cppflags</span></div><div class="line"><span class="comment"> * --ldflags` -lpthread -Wl,--no-as-needed -lChimeraTK-DeviceAccess-DoocsBackend</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="preprocessor">#include &lt;ChimeraTK/Device.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="accessor1_d_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {</div><div class="line">  <a class="code" href="class_chimera_t_k_1_1_device.html">ChimeraTK::Device</a> d;</div><div class="line">  d.<a class="code" href="class_chimera_t_k_1_1_device.html#aedbf8aa7daab16909fe3df80c788d0bf">open</a>(<span class="stringliteral">&quot;(doocs:TEST.DOOCS/LOCALHOST_610498009/Bakery)&quot;</span>);</div><div class="line"></div><div class="line">  <span class="comment">// You have to activate the receiving of asynchronousy send data before an accessor with AccessMode::wait_for_new_data</span></div><div class="line">  <span class="comment">// will receive anything. You can first create all accessors and then activate all of them at the same point in time</span></div><div class="line">  <span class="comment">// with this.</span></div><div class="line">  d.<a class="code" href="class_chimera_t_k_1_1_device.html#ad7c7d319aa029ecdb9a1e5aae5e667af">activateAsyncRead</a>();</div><div class="line"></div><div class="line">  <span class="comment">// The third argument is a list of ChimeraTK::AccessMode. We only have one argument in it:</span></div><div class="line">  <span class="comment">// AccessMode::wait_for_new_data.</span></div><div class="line">  <span class="keyword">auto</span> temperature =</div><div class="line">      d.<a class="code" href="class_chimera_t_k_1_1_device.html#a953db6616908b17380fb1ace248c5a77">getScalarRegisterAccessor</a>&lt;<span class="keywordtype">float</span>&gt;(<span class="stringliteral">&quot;Oven.temperatureReadback&quot;</span>, 0, {<a class="code" href="namespace_chimera_t_k.html#ab626f75a2569cda2f3b0869d754aee11aa32635b4f0dfdd132457f6a499d6f031">ChimeraTK::AccessMode::wait_for_new_data</a>});</div><div class="line"></div><div class="line">  <span class="comment">// The read now blocks until data is received. You can use it to syncrchonise your code to incoming data. No need for</span></div><div class="line">  <span class="comment">// additional sleeps etc.</span></div><div class="line">  <span class="keywordflow">while</span>(<span class="keyword">true</span>) {</div><div class="line">    temperature.read();</div><div class="line">    std ::cout &lt;&lt; <span class="stringliteral">&quot;The temperature is &quot;</span> &lt;&lt; temperature &lt;&lt; <span class="stringliteral">&quot; degC. &quot;</span> &lt;&lt; std ::endl;</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Nov 30 2022 04:54:28 for ChimeraTK-DeviceAccess by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
