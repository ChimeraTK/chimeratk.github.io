<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ChimeraTK-ApplicationCore: Technical specification: data validity propagation Specification version V1.0RC2</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ChimeraTK_Logo_whitebg.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ChimeraTK-ApplicationCore
   &#160;<span id="projectnumber">02.00.04</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('spec_data_validity_propagation.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Technical specification: data validity propagation Specification version V1.0RC2 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><blockquote class="doxtable">
<p><b>This is a release candidate in implementation</b></p>
</blockquote>
<blockquote class="doxtable">
<p><b>NOTICE FOR FUTURE RELEASES: AVOID CHANGING THE NUMBERING!</b> The tests refer to the sections, incl. links and unlinked references from tests or other parts of the specification. These break, or even worse become wrong, when they are not changed consistenty! </p>
</blockquote>
<h2>1. General idea </h2>
<ul>
<li>1.1 In ApplicationCore each variable has a data validiy flag attached to it. DataValidity can be 'ok' or 'faulty'.</li>
<li>1.2 This flag is automatically propagated: If any of the inputs of an <a class="el" href="class_chimera_t_k_1_1_application_module.html">ApplicationModule</a> is faulty, the data validity of the module becomes faulty, which means all outputs of this module will automatically be flagged as faulty. Fan-outs might be special cases (see 2.4).</li>
<li>1.3 If a device is in error state, all variables which are read from it shall be marked as 'faulty'. This flag is then propagated through all the modules (via 1.1.2) so it shows up in the control system.</li>
<li>1.4 The user code has the possibility to query the data validity of the module</li>
<li>1.5 The user code has the possibility to set the data validity of the module to 'faulty'. However, the user code cannot actively set the module to 'ok' if any of the module inputs are 'faulty'.</li>
<li><a class="anchor" id="dataValidity_1_6"></a>1.6 The user code can flag individual outputs as bad. However, the user code cannot actively set an output to 'ok' if the data validity of the module is 'faulty'. <a class="el" href="spec_data_validity_propagation.html#dataValidity_comment_1_6">(*)</a></li>
<li>1.7 The user code can get the data validity flag of individual inputs and take special actions.</li>
<li>1.8 The data validity of receiving variables is set to 'faulty' on construction. Like this, data is marked as faulty as long as no sensible initial values have been propagated.</li>
</ul>
<h3>Comments</h3>
<ul>
<li><a class="anchor" id="dataValidity_comment_1_6"></a><a class="el" href="spec_data_validity_propagation.html#dataValidity_1_6">1.6</a>: The alternative implementation to add a data validity flag to the write() function is not a good solution because it does not work with writeAll().</li>
</ul>
<h2>2. Technical implementation </h2>
<h3>2.1 <a class="el" href="class_chimera_t_k_1_1_meta_data_propagating_register_decorator.html" title="NDRegisterAccessorDecorator which propagates meta data attached to input process variables through th...">MetaDataPropagatingRegisterDecorator</a> (*)</h3>
<ul>
<li>2.1.1 Each input and each output of a module (or fan out) is decorated with a <a class="el" href="class_chimera_t_k_1_1_meta_data_propagating_register_decorator.html" title="NDRegisterAccessorDecorator which propagates meta data attached to input process variables through th...">MetaDataPropagatingRegisterDecorator</a> (except for the <a class="el" href="class_chimera_t_k_1_1_trigger_fan_out.html" title="InternalModule which waits for a trigger, then reads a number of variables and distributes each of th...">TriggerFanOut</a>, see. <a class="el" href="spec_data_validity_propagation.html#dataValidity_2_4">2.4</a>)</li>
<li>2.1.2 The decorator knows about the module it is connected to. It is called the 'owner'.</li>
<li>2.1.3 <b>read:</b> For each read operation it checks the incoming data validity and increases/decreases the data fault counter of the owner.</li>
<li>2.1.5 <b>write:</b> When writing, the decorator is checking the validity of the owner and the individual flag of the output set by the user. Only if both are 'ok' the output validity is 'ok', otherwise the outgoing data is send as 'faulty'.</li>
</ul>
<h3>2.2 removed</h3>
<h3>2.3 <a class="el" href="class_chimera_t_k_1_1_application_module.html">ApplicationModule</a></h3>
<ul>
<li>2.3.1 Each <a class="el" href="class_chimera_t_k_1_1_application_module.html">ApplicationModule</a> has one data fault counter variable which is increased/decreased by <a class="el" href="class_chimera_t_k_1_1_entity_owner.html#a59d02ecae8bc99e76c7561c3ccea946c" title="Set the data validity flag to fault and increment the fault counter. ">EntityOwner::incrementDataFaultCounter()</a> and <a class="el" href="class_chimera_t_k_1_1_entity_owner.html#a2e6036e82c5f3b01bc062ceb431f94bb" title="Decrement the fault counter and set the data validity flag to ok if the counter has reached 0...">EntityOwner::decrementDataFaultCounter</a>.</li>
<li>2.3.2 All inputs and outputs have a <a class="el" href="class_chimera_t_k_1_1_meta_data_propagating_register_decorator.html" title="NDRegisterAccessorDecorator which propagates meta data attached to input process variables through th...">MetaDataPropagatingRegisterDecorator</a>.</li>
<li><a class="anchor" id="dataValidity_2_3_3"></a>2.3.3 The main loop of the module usualy does not care about data validity. If any input is invalid, all outputs are automatically invalid <a class="el" href="spec_data_validity_propagation.html#dataValidity_comment_2_3_3a">(*)</a>. The loop just runs through normaly, even if an input has invalid data. <a class="el" href="spec_data_validity_propagation.html#dataValidity_comment_2_3_3b">(*)</a></li>
<li>2.3.4 Inside the <a class="el" href="class_chimera_t_k_1_1_application_module.html">ApplicationModule</a> main loop the module's data fault counter is accessible. The user can increment and decrement it, but has to be careful to do this in pairs. The more common use case will be to query the module's data validity.</li>
</ul>
<h3>2.4 <a class="el" href="class_chimera_t_k_1_1_trigger_fan_out.html" title="InternalModule which waits for a trigger, then reads a number of variables and distributes each of th...">TriggerFanOut</a></h3>
<p><a class="anchor" id="dataValidity_2_4"></a> The <a class="el" href="class_chimera_t_k_1_1_trigger_fan_out.html" title="InternalModule which waits for a trigger, then reads a number of variables and distributes each of th...">TriggerFanOut</a> is special in the sense that it does not compute anything, but reads multiple independent poll-type inputs when a trigger arrives, and pushes them out. In contrast to an <a class="el" href="class_chimera_t_k_1_1_application_module.html">ApplicationModule</a> or one of the data fan-outs, their data validities are not connected.</p>
<ul>
<li>2.4.1 Only the push-type trigger input of the <a class="el" href="class_chimera_t_k_1_1_trigger_fan_out.html" title="InternalModule which waits for a trigger, then reads a number of variables and distributes each of th...">TriggerFanOut</a> is equiped with a <a class="el" href="class_chimera_t_k_1_1_meta_data_propagating_register_decorator.html" title="NDRegisterAccessorDecorator which propagates meta data attached to input process variables through th...">MetaDataPropagatingRegisterDecorator</a>.</li>
<li><a class="anchor" id="dataValidity_2_4_2"></a>2.4.2 The poll-type data inputs do not have a <a class="el" href="class_chimera_t_k_1_1_meta_data_propagating_register_decorator.html" title="NDRegisterAccessorDecorator which propagates meta data attached to input process variables through th...">MetaDataPropagatingRegisterDecorator</a>. <a class="el" href="spec_data_validity_propagation.html#dataValidity_comment_2_4_2">(*)</a>.</li>
<li>2.4.3 The individual poll-type inputs propagate the data validity flag only to the corresponding outputs.</li>
<li><a class="anchor" id="dataValidity_2_4_4"></a>2.4.4 Although the trigger conceptually has data type 'void', it can also be <code>faulty</code> <a class="el" href="spec_data_validity_propagation.html#dataValidity_comment_2_4_4">(*)</a>. An invalid trigger is processed, but all read out data is flagged as <code>faulty</code>.</li>
</ul>
<h3>2.5 Interaction with exception handling</h3>
<p>See <a class="el" href="spec_execption_handling.html">Technical specification: Exception handling for device runtime errors V1.0RC2WIP</a>.</p>
<ul>
<li>2.5.1 The <a class="el" href="class_chimera_t_k_1_1_meta_data_propagating_register_decorator.html" title="NDRegisterAccessorDecorator which propagates meta data attached to input process variables through th...">MetaDataPropagatingRegisterDecorator</a> is always placed <em>around</em> the <a class="el" href="class_chimera_t_k_1_1_exception_handling_decorator.html" title="Decorator of the NDRegisterAccessor which facilitates tests of the application. ">ExceptionHandlingDecorator</a> if both decorators are used on a process variable. Like this a <code>faulty</code> flag raised by the <a class="el" href="class_chimera_t_k_1_1_exception_handling_decorator.html" title="Decorator of the NDRegisterAccessor which facilitates tests of the application. ">ExceptionHandlingDecorator</a> is automatically picked up by the <a class="el" href="class_chimera_t_k_1_1_meta_data_propagating_register_decorator.html" title="NDRegisterAccessorDecorator which propagates meta data attached to input process variables through th...">MetaDataPropagatingRegisterDecorator</a>.</li>
<li>2.5.2 The first failing read returns with the old data and the 'faulty' flag. Like this the flag is propagated to the outputs. Only further reads might freeze until the device is available again.</li>
</ul>
<h3>2.6 <a class="el" href="class_chimera_t_k_1_1_application.html">Application</a> class</h3>
<ul>
<li>2.6.1 For device variables, the requirement of setting receiving endpoints to 'faulty' on construction can not be fulfilled. In DeviceAccess the accessors are bidirectional and provide no possibility to distinguish sender and receiver. Instead, the validity is set right after construction in <a class="el" href="class_chimera_t_k_1_1_application.html#a3f9ce1e49b8dfc7f9228a2db7db0a775" title="Perform the actual connection of an accessor to a device register. ">Application::createDeviceVariable()</a> for receivers.</li>
</ul>
<h3>Comments:</h3>
<ul>
<li>2.1 The <a class="el" href="class_chimera_t_k_1_1_meta_data_propagating_register_decorator.html" title="NDRegisterAccessorDecorator which propagates meta data attached to input process variables through th...">MetaDataPropagatingRegisterDecorator</a> also propagates the version number, not only the data validity flag. Hence it's not called DataValidityPropagatingRegisterDecorator.</li>
<li><a class="anchor" id="dataValidity_comment_2_3_3a"></a><a class="el" href="spec_data_validity_propagation.html#dataValidity_2_3_3">2.3.3</a> If a module has an output that would still be valid, even though one of the inputs is faulty, it means that the output is not connected to that particular input. This is an indicator that the module is doing unrelated things and probably should be split.</li>
<li><a class="anchor" id="dataValidity_comment_2_3_3b"></a><a class="el" href="spec_data_validity_propagation.html#dataValidity_2_3_3">2.3.3</a> A change of the data validity of the module does not automatically change the validity on all outputs. A module might not always write all of its outputs. If the module's data validity is 'faulty', those outputs which are not written stay valid. This is correct because their calculation was not affected by the faulty data yet. And if an output which has faulty data is not updated when the data validity goes back to 'ok' it also stays 'faulty', which is correct as well.</li>
<li><a class="anchor" id="dataValidity_comment_2_4_2"></a><a class="el" href="spec_data_validity_propagation.html#dataValidity_2_4_2">2.4.2</a> The data validities of the different poll type inputs are not correlated, so they shall not be propagated to the TriggerFanOuts data fault counter. The version numbers of poll-type inputs are not propagated anyway, so there is nothing for the decorator to do.</li>
<li><a class="anchor" id="dataValidity_comment_2_4_4"></a><a class="el" href="spec_data_validity_propagation.html#dataValidity_2_4_4">2.4.4</a> A void variable can be invalid if the sending device fails, hence there is no new data, and then a heartbeat times out and raises an exception. This will result in a void variable with data validity <code>faulty</code> because it does not originate form a recevied message.</li>
</ul>
<h2>3. Implementation details </h2>
<ul>
<li>3.1 The decorators which manipulate the data fault counter are responsible for counting up and down in pairs, such that the counter goes back to 0 if all data is ok, and never becomes negative. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">index</a></li>
    <li class="footer">Generated on Mon Feb 7 2022 04:56:31 for ChimeraTK-ApplicationCore by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
