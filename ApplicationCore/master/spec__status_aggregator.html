<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ChimeraTK-ApplicationCore: Technical specification: StatusAggregator</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ChimeraTK_Logo_whitebg.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ChimeraTK-ApplicationCore
   &#160;<span id="projectnumber">master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('spec__status_aggregator.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Technical specification: StatusAggregator </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_doc_spec_StatusAggregator"></a></p>
<blockquote class="doxtable">
<p><b>DRAFT VERSION, WRITE-UP IN PROGRESS!</b> </p>
</blockquote>
<blockquote class="doxtable">
<p>**NOTE: As aggregator and monitor are tighly coupled, we might have one spec page for both ** </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md46"></a>
Introduction</h1>
<p>The <code><a class="el" href="struct_chimera_t_k_1_1_status_aggregator.html" title="The StatusAggregator collects results of multiple StatusMonitor instances and aggregates them into a ...">ChimeraTK::StatusAggregator</a></code> provides a facitlity to collect multiple statuses and merge them into a single output status. The sources of input statuses can be:</p>
<ul>
<li>Instances of <code>ChimeraTK::StatusMonitor</code></li>
<li>Other instances of the StatusAggregator</li>
</ul>
<h1><a class="anchor" id="autotoc_md47"></a>
High-level requirements</h1>
<h2><a class="anchor" id="autotoc_md48"></a>
R1.1 Automatic detection of instances</h2>
<p>The StatusMonitor and StatusAggregator instances to be connected into the StatusAggregator should be found automatically as follows:</p>
<ul>
<li><b>R1.1.1</b>: A StatusAggregator aggregates all instances in the hierarchy of ApplicationCore Modules which are at the same hierarchy level or below</li>
<li><b>R1.1.2</b>: Two StatusAggregator instances cannot be on the same hierarchy level - this should throw a <code>ChimeraTK::logic_error</code></li>
<li><b>R1.1.3</b>: If a StatusAggregator is found at some hierarchy level below, the search is stopped for that branch of the hierarchy tree, i.e. all variables which are already aggregated by that aggregator are not aggregated again</li>
<li><b>R1.1.4</b>: The StatusAggregator provides a <code>disable</code> input, which deactivates the aggregator and sets the output status to OFF.</li>
</ul>
<h2><a class="anchor" id="autotoc_md49"></a>
R1.2 Priorization of status values</h2>
<p>The StatusAggregator is configurable (by a constructor parameter, not a PV) in the way how the statuses are prioritised. The status with the highest priority within the aggregated instances defines the aggregated status. The following options exist (highest priority first):</p>
<ol type="1">
<li>error - warning - off - ok</li>
<li>error - warning - ok - off</li>
<li>error - warning - ok or off - mixed state of ok/off results in a warning</li>
<li>off - error - warning - ok</li>
</ol>
<h2><a class="anchor" id="autotoc_md50"></a>
Constraints and issues</h2>
<ul>
<li>As detection of underlying instances can only be performed in the constructor, the StatusAggregator has to be declared in user code after all instances of <code>ChimeraTK::StatusMonitor</code> in a Module.</li>
<li>Usage of <code>HierarchyModifier::moveToRoot</code> on a StatusAggregator is controversial (currently not allowed, see R2.2):<ul>
<li>Either: Detection of aggregated instances may take place from the virtual hierarchy level of the original (C++) parent module downwards. The Aggregator and its status output would then appear on the root level.</li>
<li>Or: <code>HierarchyModifier::moveToRoot</code> is not allowed on StatusAggregators</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md51"></a>
Implementation</h1>
<h2><a class="anchor" id="autotoc_md52"></a>
Requirements</h2>
<ul>
<li><b>R2.1</b>: The detection of instances needs to be performed recursively from the StatusAggregator's virtual parent module on</li>
<li><b>R2.2</b>: The detection has to work on instances the are modified by <code><a class="el" href="namespace_chimera_t_k.html#a335687084d53741a8764f40a3e6d35c0" title="Hierarchy modifier: specify if and how the module hierarchy should be modified.">ChimeraTK::HierarchyModifier</a></code>s <code>none</code> and <code>hideThis</code>. Other modifiers should give a <code>ChimeraTK::logic_error</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md53"></a>
Constraints and issues</h2>
<ul>
<li>The detection and connection of the instances to be aggregated has to be performed in the constructor, later the variable household is fixed and the status inputs can not be added anymore.</li>
<li>As a consequence of the implementation requirements, in order to get the virtual parent module, the entire Application needs to be virtualised and the search algorithm must then navigate to the parent module.</li>
<li>Related to R1.1.3: If a StatusAggregator is found on a level below, the instances of <code>ChimeraTK::StatusMonitor</code>s on that level must be ignored. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">index</a></li>
    <li class="footer">Generated on Thu Apr 6 2023 03:56:55 for ChimeraTK-ApplicationCore by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
