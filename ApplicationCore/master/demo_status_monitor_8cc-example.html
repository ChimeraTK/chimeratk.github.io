<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ChimeraTK-ApplicationCore: demoStatusMonitor.cc</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ChimeraTK_Logo_whitebg.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ChimeraTK-ApplicationCore
   &#160;<span id="projectnumber">master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('demo_status_monitor_8cc-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">demoStatusMonitor.cc</div>  </div>
</div><!--header-->
<div class="contents">
<p>For more info see <a class="el" href="statusmonitordoc.html">Status Monitor</a></p>
<div class="fragment"><div class="line"><span class="comment">// SPDX-FileCopyrightText: Deutsches Elektronen-Synchrotron DESY, MSK, ChimeraTK Project &lt;chimeratk-support@desy.de&gt;</span></div><div class="line"><span class="comment">// SPDX-License-Identifier: LGPL-3.0-or-later</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;ChimeraTK/ApplicationCore/ApplicationCore.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;ChimeraTK/ApplicationCore/EnableXMLGenerator.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;ChimeraTK/ApplicationCore/ModuleGroup.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;ChimeraTK/ApplicationCore/StatusMonitor.h&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span><a class="code" href="namespace_chimera_t_k.html">ctk</a> = <a class="code" href="namespace_chimera_t_k.html">ChimeraTK</a>;</div><div class="line"></div><div class="line"><span class="comment">// Just simulate a temperature going up and down</span></div><div class="line"><span class="keyword">struct </span><a name="_a0"></a><a class="code" href="struct_simulation_module.html">SimulationModule</a> : <span class="keyword">public</span> <a name="_a1"></a><a class="code" href="class_chimera_t_k_1_1_application_module.html">ctk::ApplicationModule</a> {</div><div class="line">  <span class="keyword">using</span> <a name="a2"></a><a class="code" href="class_chimera_t_k_1_1_application_module.html#a527d36175aa9b3126553b6a2a8933e38">ctk::ApplicationModule::ApplicationModule</a>;</div><div class="line"></div><div class="line">  <a name="_a3"></a><a class="code" href="struct_chimera_t_k_1_1_scalar_output.html">ctk::ScalarOutput&lt;double&gt;</a> <a name="a4"></a><a class="code" href="struct_simulation_module.html#a175e53b11599c4846dbf85d27bc59eae">temperature</a>{<span class="keyword">this</span>, <span class="stringliteral">&quot;temperature&quot;</span>, <span class="stringliteral">&quot;degC&quot;</span>, <span class="stringliteral">&quot;simulated temperature&quot;</span>};</div><div class="line"></div><div class="line">  <span class="keywordtype">void</span> <a name="a5"></a><a class="code" href="struct_simulation_module.html#a939276bda8e1c1c0d8f28c3c45671f0f">mainLoop</a>() {</div><div class="line">    <a class="code" href="struct_simulation_module.html#a175e53b11599c4846dbf85d27bc59eae">temperature</a> = 0;</div><div class="line">    <a class="code" href="struct_simulation_module.html#a175e53b11599c4846dbf85d27bc59eae">temperature</a>.<a name="a6"></a><a class="code" href="class_chimera_t_k_1_1_scalar_accessor.html#a02f5ea46e0582dfceb8e9cc06b25c302">write</a>();</div><div class="line">    <span class="keywordtype">double</span> direction = 1;</div><div class="line"></div><div class="line">    <span class="keywordflow">while</span>(<span class="keyword">true</span>) {</div><div class="line">      <span class="comment">// go down with the temperature if too hot</span></div><div class="line">      <span class="keywordflow">if</span>(<a class="code" href="struct_simulation_module.html#a175e53b11599c4846dbf85d27bc59eae">temperature</a> &gt; 50) {</div><div class="line">        direction = -1;</div><div class="line">      }</div><div class="line">      <span class="comment">// go up with the temperature if too cold</span></div><div class="line">      <span class="keywordflow">if</span>(<a class="code" href="struct_simulation_module.html#a175e53b11599c4846dbf85d27bc59eae">temperature</a> &lt; -50) {</div><div class="line">        direction = 1;</div><div class="line">      }</div><div class="line"></div><div class="line">      <a class="code" href="struct_simulation_module.html#a175e53b11599c4846dbf85d27bc59eae">temperature</a> += direction * 1; <span class="comment">// one dregree steps</span></div><div class="line">      <a name="a7"></a><a class="code" href="class_chimera_t_k_1_1_application_module.html#aa36ac737e999a242eaf8c49f92524b15">setCurrentVersionNumber</a>({});  <span class="comment">// We generate data without trigger or other input.</span></div><div class="line">                                    <span class="comment">// So we must update the version number manually.</span></div><div class="line">                                    <span class="comment">// This automatically updates the time stamp as well.</span></div><div class="line">      <a class="code" href="struct_simulation_module.html#a175e53b11599c4846dbf85d27bc59eae">temperature</a>.<a class="code" href="class_chimera_t_k_1_1_scalar_accessor.html#a02f5ea46e0582dfceb8e9cc06b25c302">write</a>();</div><div class="line">      usleep(100000);</div><div class="line">    }</div><div class="line">  }</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">struct </span><a name="_a8"></a><a class="code" href="struct_example_app.html">ExampleApp</a> : <span class="keyword">public</span> <a name="_a9"></a><a class="code" href="class_chimera_t_k_1_1_application.html">ctk::Application</a> {</div><div class="line">  <a class="code" href="struct_example_app.html">ExampleApp</a>() : <a class="code" href="namespace_chimera_t_k.html#a8ef88da2631968bb315b54f3bf2e9f1dae498749f3c42246d50b15c81c101d988">Application</a>(<span class="stringliteral">&quot;exampleApp&quot;</span>) {</div><div class="line">    <span class="comment">// show how it looks in the application (C++ hierarchy)</span></div><div class="line">    <a name="a10"></a><a class="code" href="class_chimera_t_k_1_1_entity_owner.html#ac641f46d97a7c0aa862e05e1fcedc6e4">dump</a>();</div><div class="line"></div><div class="line">    <span class="comment">// show how it looks on the cs side (virtual hierarchy)</span></div><div class="line">    <span class="comment">// cs.dump();</span></div><div class="line"></div><div class="line">    <span class="comment">// show how it is connected</span></div><div class="line">    dumpConnections();</div><div class="line">  }</div><div class="line">  ~<a class="code" href="struct_example_app.html">ExampleApp</a>() { <a class="code" href="namespace_chimera_t_k.html#a69c04b7fb1519cd2b454be33d88bb72da5924f03a95ee6f7277e5bdd1e81b8fdc">shutdown</a>(); }</div><div class="line"></div><div class="line">  <span class="comment">// Create an instance of the simulation module. We name it &quot;Simulation&quot;.</span></div><div class="line">  <span class="comment">// There will be a variable /Simulation/temperature from this.</span></div><div class="line">  <a class="code" href="struct_simulation_module.html">SimulationModule</a> simulation{<span class="keyword">this</span>, <span class="stringliteral">&quot;Simulation&quot;</span>, <span class="stringliteral">&quot;temperature simulation&quot;</span>};</div><div class="line"></div><div class="line">  <span class="comment">// Now we place a monitor next to the temperature variable. First we create a module group, also with the name</span></div><div class="line">  <span class="comment">// &quot;Simulation&quot;. Everything in it will be placed next to the variables from the simulation module.</span></div><div class="line">  struct : <a name="_a11"></a><a class="code" href="class_chimera_t_k_1_1_module_group.html">ctk::ModuleGroup</a> {</div><div class="line">    <span class="keyword">using</span> <a name="a12"></a><a class="code" href="class_chimera_t_k_1_1_module_group.html#ac6f8414b7c904b85c67cc2b4ddf87a7f">ctk::ModuleGroup::ModuleGroup</a>;</div><div class="line">    <span class="comment">// Inside the module group we place the monitor. In the constructor it gets the name of the variable to monitor, and</span></div><div class="line">    <span class="comment">// the name of the output variable. The monitor automatically connects to the input variable that is in the same</span></div><div class="line">    <span class="comment">// hierarchy level. We add output and parameter tags (STATUS and CONFIG, respectively) for easier connetion of the</span></div><div class="line">    <span class="comment">// variables.</span></div><div class="line">    <span class="comment">// ctk::RangeMonitor&lt;double&gt; temperatureMonitor{this, &quot;TemperatureMonitor&quot;, &quot;monitor for the simulated temperature&quot;,</span></div><div class="line">    <span class="comment">//    &quot;temperature&quot;, &quot;temperatureStatus&quot;, ctk::HierarchyModifier::none, {&quot;STATUS&quot;}, {&quot;CONFIG&quot;}, {}};</span></div><div class="line"></div><div class="line">    <a name="_a13"></a><a class="code" href="struct_chimera_t_k_1_1_range_monitor.html">ctk::RangeMonitor&lt;double&gt;</a> temperatureMonitor{<span class="keyword">this</span>, <span class="stringliteral">&quot;/TemperatureMonitor/temperature&quot;</span>,</div><div class="line">        <span class="stringliteral">&quot;/TemperatureMonitor/temperatureStatus&quot;</span>, <span class="stringliteral">&quot;/TemperatureMonitor&quot;</span>, <span class="stringliteral">&quot;monitor for the simulated temperature&quot;</span>,</div><div class="line">        <a class="code" href="namespace_chimera_t_k.html#a0ed227f630f3662ae808b4e91a6018c8">ctk::TAGS</a>{<span class="stringliteral">&quot;MON_OUTPUT&quot;</span>}, <a class="code" href="namespace_chimera_t_k.html#a0ed227f630f3662ae808b4e91a6018c8">ctk::TAGS</a>{<span class="stringliteral">&quot;MON_PARAMS&quot;</span>}};</div><div class="line"></div><div class="line">  } simulationGroup{<span class="keyword">this</span>, <span class="stringliteral">&quot;Simulation&quot;</span>, <span class="stringliteral">&quot;&quot;</span>};</div><div class="line"></div><div class="line">  <a name="_a14"></a><a class="code" href="struct_chimera_t_k_1_1_config_reader.html">ctk::ConfigReader</a> config{<span class="keyword">this</span>, <span class="stringliteral">&quot;Config&quot;</span>, <span class="stringliteral">&quot;demoStatusMonitor_config.xml&quot;</span>};</div><div class="line">  <span class="comment">// ctk::ControlSystemModule cs;</span></div><div class="line">  <span class="comment">// void defineConnections();</span></div><div class="line">};</div><div class="line"></div><div class="line"><a class="code" href="struct_example_app.html">ExampleApp</a> <a name="a15"></a><a class="code" href="demo_status_monitor_8cc.html#a7e2de60c48b2000be30339c6c9f1c8ed">theExampleApp</a>;</div><div class="line"></div><div class="line"><span class="comment">// void ExampleApp::defineConnections() {</span></div><div class="line"><span class="comment">//   // Usually you set the dmap file here. This example does not have one.</span></div><div class="line"></div><div class="line"><span class="comment">//  // Connect everything in the app to the cs. This makes the connection of temperature from Simulation to the input of</span></div><div class="line"><span class="comment">//  // the monitor because they are the same variable in the CS module. Also the disable variable if the monitor is</span></div><div class="line"><span class="comment">//  // connected to the CS. Try what happens if you disable the monitor.</span></div><div class="line"><span class="comment">//  findTag(&quot;.*&quot;).connectTo(cs);</span></div><div class="line"></div><div class="line"><span class="comment">//  /* The trick of connecting the temperature automatically only worked because we put the temperatureMonitor into the</span></div><div class="line"><span class="comment">//   * correct place in the hierarchy by putting it into the variable group &quot;Simulation&quot;. However, the threshold</span></div><div class="line"><span class="comment">//   * parameters inside the monitor are not connected yet.</span></div><div class="line"><span class="comment">//   *</span></div><div class="line"><span class="comment">//   * When connecting the app, the config created the following variables:</span></div><div class="line"><span class="comment">//   * /Config/TemperatureMonitor/lowerWarningThreshold</span></div><div class="line"><span class="comment">//   * /Config/TemperatureMonitor/upperWarningThreshold</span></div><div class="line"><span class="comment">//   * /Config/TemperatureMonitor/lowerFaultThreshold</span></div><div class="line"><span class="comment">//   * /Config/TemperatureMonitor/upperFaultThreshold</span></div><div class="line"><span class="comment">//   */</span></div><div class="line"></div><div class="line"><span class="comment">//  // Now we connect the parameters of the temperature monitor to the control system, right into the Config directory so</span></div><div class="line"><span class="comment">//  // the variable names match. Like this the parameters are connected to the values coming from the configuration.</span></div><div class="line"><span class="comment">//  findTag(&quot;CONFIG&quot;).flatten().connectTo(cs[&quot;Config&quot;][&quot;TemperatureMonitor&quot;]);</span></div><div class="line"></div><div class="line"><span class="comment">//  // FIXME: At this point a status aggregator would connect everything with tag STATUS</span></div><div class="line"></div><div class="line"><span class="comment">//  // show how it looks in the application (C++ hierarchy)</span></div><div class="line"><span class="comment">//  dump();</span></div><div class="line"></div><div class="line"><span class="comment">//  // show how it looks on the cs side (virtual hierarchy)</span></div><div class="line"><span class="comment">//  cs.dump();</span></div><div class="line"></div><div class="line"><span class="comment">//  // show how it is connected</span></div><div class="line"><span class="comment">//  dumpConnections();</span></div><div class="line"><span class="comment">//}</span></div></div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Dec 21 2022 04:56:09 for ChimeraTK-ApplicationCore by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
